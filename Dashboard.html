<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | DocuWrite Pro</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Replaced Material Icons with Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

<style>
    /* General Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Roboto', Arial, sans-serif;
    }

    /* --- THEME VARIABLES --- */
    :root {
        --theme-bg: #f8f9fa;
        --theme-surface: #ffffff;
        --theme-surface-glass: rgba(255, 255, 255, 0.3);
        --theme-surface-glass-hover: rgba(255, 255, 255, 0.5);
        --theme-surface-tools: #fff;
        --theme-surface-card: #fff;
        --theme-text: #202124;
        --theme-text-secondary: #5f6368;
        --theme-border: #dadce0;
        --theme-primary: #1a73e8;
        --theme-primary-hover: #1765c4;
        --theme-hover-bg: #f1f3f4;
        --theme-logo-color: #5f6368;

        /* BG Animation */
        --bg-grad-1: #f5f7fa;
        --bg-grad-2: #e4edf9;
        --bg-bubble: rgba(156, 39, 176, 0.05);
        --bg-pulse: rgba(66, 133, 244, 0.1);
        --bg-particle-1: #4285F4;
        --bg-particle-2: #9C27B0;
    }

    body.dark-theme {
        --theme-bg: #121212;
        --theme-surface: #1f1f1f;
        --theme-surface-glass: rgba(30, 30, 30, 0.6);
        --theme-surface-glass-hover: rgba(45, 45, 45, 0.6);
        --theme-surface-tools: #1a1a1a;
        --theme-surface-card: #1f1f1f;
        --theme-text: #f1f1f1;
        --theme-text-secondary: #aaa;
        --theme-border: #333;
        --theme-primary: #4285F4;
        --theme-primary-hover: #5a95f5;
        --theme-hover-bg: #333;
        --theme-logo-color: #aaa;

        /* BG Animation */
        --bg-grad-1: #0a0a0a;
        --bg-grad-2: #1f1f1f;
        --bg-bubble: rgba(156, 39, 176, 0.08);
        --bg-pulse: rgba(66, 133, 244, 0.15);
        --bg-particle-1: #4285F4;
        --bg-particle-2: #9C27B0;
    }
    
    body.red-theme {
        --theme-bg: #fbe9e7;
        --theme-surface: #ffccbc;
        --theme-surface-glass: rgba(255, 204, 188, 0.3);
        --theme-surface-glass-hover: rgba(255, 204, 188, 0.5);
        --theme-surface-tools: #ffccbc;
        --theme-surface-card: #ffebee;
        --theme-text: #b71c1c;
        --theme-text-secondary: #d32f2f;
        --theme-border: #ffab91;
        --theme-primary: #f44336;
        --theme-primary-hover: #e53935;
        --theme-hover-bg: #ff8a65;
        --theme-logo-color: #b71c1c;

        /* BG Animation */
        --bg-grad-1: #fbe9e7;
        --bg-grad-2: #ffccbc;
        --bg-bubble: rgba(244, 67, 54, 0.1);
        --bg-pulse: rgba(211, 47, 47, 0.1);
        --bg-particle-1: #f44336;
        --bg-particle-2: #d32f2f;
    }
    
    body.blue-theme {
        --theme-bg: #e3f2fd;
        --theme-surface: #bbdefb;
        --theme-surface-glass: rgba(187, 222, 251, 0.3);
        --theme-surface-glass-hover: rgba(187, 222, 251, 0.5);
        --theme-surface-tools: #bbdefb;
        --theme-surface-card: #e3f2fd;
        --theme-text: #0d47a1;
        --theme-text-secondary: #1565c0;
        --theme-border: #90caf9;
        --theme-primary: #2196F3;
        --theme-primary-hover: #1976D2;
        --theme-hover-bg: #64b5f6;
        --theme-logo-color: #0d47a1;

        /* BG Animation */
        --bg-grad-1: #e3f2fd;
        --bg-grad-2: #bbdefb;
        --bg-bubble: rgba(33, 150, 243, 0.1);
        --bg-pulse: rgba(25, 118, 210, 0.1);
        --bg-particle-1: #2196F3;
        --bg-particle-2: #1976D2;
    }
    
    body.green-theme {
        --theme-bg: #e8f5e9;
        --theme-surface: #c8e6c9;
        --theme-surface-glass: rgba(200, 230, 201, 0.3);
        --theme-surface-glass-hover: rgba(200, 230, 201, 0.5);
        --theme-surface-tools: #c8e6c9;
        --theme-surface-card: #e8f5e9;
        --theme-text: #1b5e20;
        --theme-text-secondary: #2e7d32;
        --theme-border: #a5d6a7;
        --theme-primary: #4CAF50;
        --theme-primary-hover: #388E3C;
        --theme-hover-bg: #81c784;
        --theme-logo-color: #1b5e20;
        
        /* BG Animation */
        --bg-grad-1: #e8f5e9;
        --bg-grad-2: #c8e6c9;
        --bg-bubble: rgba(76, 175, 80, 0.1);
        --bg-pulse: rgba(56, 142, 60, 0.1);
        --bg-particle-1: #4CAF50;
        --bg-particle-2: #388E3C;
    }
    
    /* This class is added by JS for custom colors */
    body.custom-theme { /* Variables are set by JS inline <style> */ }


    body {
        background-color: var(--theme-bg);
        color: var(--theme-text);
        transition: background-color 0.3s, color 0.3s;
        overflow-x: hidden; /* Prevent horizontal scroll */
    }

    /* Used by JS to pause/play */
    body.bg-animation-paused .bubble,
    body.bg-animation-paused .pulse span,
    body.bg-animation-paused .particle {
        animation-play-state: paused !important;
    }
    
    /* --- NEW: Utility class --- */
    .hidden {
        display: none !important;
    }

    /* --- NEW: Account Page Styles --- */
    #accountPage {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #ffffff; /* Forced white as requested */
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .account-form-container {
        background-color: #f9f9f9;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 450px;
        text-align: center;
    }
    .account-form-container h2 {
        color: #333;
        margin-bottom: 25px;
        font-weight: 500;
    }
    .account-input-group {
        margin-bottom: 20px;
        text-align: left;
    }
    .account-input-group label {
        display: block;
        margin-bottom: 8px;
        color: #555;
        font-size: 14px;
    }
    .account-input-group input[type="text"],
    .account-input-group input[type="email"] {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    .account-input-group input[type="text"]:focus,
    .account-input-group input[type="email"]:focus {
        outline: none;
        border-color: var(--theme-primary);
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
    }
    .account-input-group input[type="file"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #fff;
        font-size: 14px;
        cursor: pointer;
    }
    #createAccountBtn {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 8px;
        background-color: var(--theme-primary);
        color: white;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.2s;
    }
    #createAccountBtn:hover {
        background-color: var(--theme-primary-hover);
        transform: translateY(-2px);
    }
    #accountErrorMsg {
        color: #D32F2F;
        font-size: 14px;
        margin-top: 15px;
        min-height: 1.2em;
    }
    /* --- END Account Page Styles --- */


    /* Animated Background */
    .animated-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--bg-grad-1) 0%, var(--bg-grad-2) 100%);
        overflow: hidden;
        z-index: -1;
        transition: background 0.3s;
    }

    .bubble {
        position: absolute;
        border-radius: 50%;
        background: var(--bg-bubble);
        z-index: 1;
        transition: background 0.3s;
    }
    .bubble:nth-child(1) { width: 120px; height: 120px; top: 10%; left: 5%; animation: float 15s infinite ease-in-out; }
    .bubble:nth-child(2) { width: 80px; height: 80px; bottom: 15%; right: 8%; animation: float 12s infinite ease-in-out; }
    .bubble:nth-child(3) { width: 60px; height: 60px; top: 40%; right: 15%; animation: float 18s infinite ease-in-out; }

    .pulse span {
        position: absolute;
        border-radius: 50%;
        background: var(--bg-pulse);
        animation: ripple-bg 6s linear infinite;
        transition: background 0.3s;
    }
    .pulse span:nth-child(1) { width: 800px; height: 800px; top: -300px; left: -300px; animation-delay: 0s; }
    .pulse span:nth-child(2) { width: 700px; height: 700px; top: -250px; right: -300px; animation-delay: 1s; }
    .pulse span:nth-child(3) { width: 600px; height: 600px; bottom: -300px; left: -200px; animation-delay: 2s; }
    .particle { 
        position: absolute; 
        background: var(--bg-particle-1); 
        border-radius: 50%; 
        opacity: 0.3; 
        z-index: 2;
        transition: background 0.3s;
        /* JS will set animation */
    }

    /* Water Drop Effect */
    .water-drop {
        position: absolute;
        border-radius: 50%;
        background: rgba(173, 216, 230, 0.5); /* Kept generic as it's a click feedback */
        transform: scale(0);
        pointer-events: none;
        animation: ripple-click 1s linear;
        z-index: 99999;
    }

    /* Keyframes */
    @keyframes float { 0%, 100% { transform: translateY(0) translateX(0); } 25% { transform: translateY(-20px) translateX(15px); } 50% { transform: translateY(10px) translateX(-20px); } 75% { transform: translateY(-15px) translateX(-10px); } }
    @keyframes ripple-bg { 0% { transform: scale(0.8); opacity: 1; } 100% { transform: scale(1.4); opacity: 0; } }
    @keyframes ripple-click { to { transform: scale(4); opacity: 0; } }

    /* Header */
    .header {
        display: flex;
        align-items: center;
        padding: 10px 24px;
        border-bottom: 1px solid var(--theme-border);
        background-color: var(--theme-surface);
        height: 60px;
        position: sticky;
        top: 0;
        z-index: 100;
        transition: background-color 0.3s, border-color 0.3s;
    }
    .logo { display: flex; align-items: center; margin-right: 30px; }
    .logo img { height: 40px; margin-right: 12px; }
    .logo h1 { font-size: 22px; font-weight: 500; color: var(--theme-logo-color); transition: color 0.3s; }
    .nav-items { display: flex; gap: 25px; overflow-x: auto; padding: 5px 0; }
    .nav-items::-webkit-scrollbar { display: none; }
    .nav-items span { font-size: 14px; color: var(--theme-text-secondary); white-space: nowrap; cursor: pointer; padding: 5px 8px; border-radius: 4px; transition: background-color 0.2s, color 0.3s; }
    .nav-items span:hover { background-color: var(--theme-hover-bg); }
    .settings-btn { 
        background: none; 
        border: none; 
        color: var(--theme-text-secondary); 
        cursor: pointer; 
        padding: 8px; 
        border-radius: 50%; 
        margin-right: 10px; 
        transition: background-color 0.2s, color 0.3s; 
        display: inline-flex; 
        align-items: center; 
        justify-content: center; 
    }
    .settings-btn:hover { background-color: var(--theme-hover-bg); }

    /* Main Content */
    .main-content { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
    .section-title { font-size: 18px; font-weight: 500; margin-bottom: 20px; color: var(--theme-text); transition: color 0.3s; }
    /* NEW: Welcome Section */
    .welcome-section {
        margin-bottom: 30px;
    }
    #welcomeGreeting {
        font-weight: 500;
        color: var(--theme-text);
        transition: color 0.3s;
        font-size: 24px;
    }
    .new-document { margin-bottom: 40px; }
    .document-cards-container { display: flex; gap: 20px; flex-wrap: wrap; }
    .document-card { display: flex; flex-direction: column; align-items: center; width: 140px; cursor: pointer; transition: transform 0.2s; }
    .document-card:hover { transform: translateY(-5px); }
    .document-icon { width: 120px; height: 160px; background-color: var(--theme-surface-card); border: 1px solid var(--theme-border); border-radius: 4px; display: flex; align-items: center; justify-content: center; position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 12px; transition: background-color 0.3s, border-color 0.3s; }
    .plus-icon { font-size: 40px !important; color: var(--theme-primary); transition: color 0.3s; }
    .document-name { font-size: 14px; font-weight: 500; color: var(--theme-text); text-align: center; transition: color 0.3s; }

    /* Tools Section */
    .popular-tools { padding: 20px; background-color: var(--theme-surface-tools); border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: background-color 0.3s; }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap; /* Allow wrapping */
        gap: 15px; /* Add gap for spacing */
    }
    
    .section-header h3 {
        flex-grow: 1;
        margin: 0;
    }

    .section-header .controls {
        display: flex;
        align-items: center;
        gap: 10px; /* Space between search and filter */
        margin-left: auto; /* Push controls to the right */
    }
    
    /* --- NEW SEARCH BAR STYLES --- */
    .search-container {
        position: relative;
        display: flex;
        align-items: center;
    }

    .search-icon {
        cursor: pointer;
        font-size: 24px;
        color: var(--theme-text-secondary);
        transition: all 0.2s;
        padding: 4px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    .search-icon:hover { color: var(--theme-primary); background-color: var(--theme-hover-bg); }
    
    .search-bar {
        width: 0;
        padding: 6px 0;
        border: none;
        border-bottom: 2px solid var(--theme-primary);
        outline: none;
        background-color: transparent;
        color: var(--theme-text);
        font-size: 14px;
        transition: all 0.3s ease-in-out;
        opacity: 0;
        visibility: hidden;
        margin-left: -20px; /* Hide it */
    }

    .search-container.active .search-bar {
        width: 180px; /* Expanded width */
        padding: 6px 10px;
        opacity: 1;
        visibility: visible;
        margin-left: 0;
    }
    
    .search-container.active .search-icon {
        color: var(--theme-primary);
    }
    /* --- END SEARCH BAR STYLES --- */

    .organize-menu { position: relative; display: inline-block; }
    
    .organize-icon {
        cursor: pointer;
        font-size: 24px; /* Matched size */
        color: var(--theme-text-secondary);
        transition: color 0.2s;
        padding: 4px; /* Matched padding */
        border-radius: 50%; /* Matched radius */
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    .organize-icon:hover { color: var(--theme-primary); background-color: var(--theme-hover-bg); }

    .filter-options { display: none; position: absolute; background-color: var(--theme-hover-bg); min-width: 180px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 10; right: 0; border-radius: 5px; padding: 10px 0; top: 100%; margin-top: 10px; transition: background-color 0.3s; }
    .dark-theme .filter-options { background-color: #2a2a2a; } /* Specific dark override */
    .filter-options span { color: var(--theme-text); padding: 12px 18px; text-decoration: none; display: block; cursor: pointer; transition: background-color 0.2s, color 0.3s; }
    .filter-options span:hover { background-color: var(--theme-hover-bg); opacity: 0.8; }
    .filter-options.show { display: block; }
    
    .tools-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 30px; margin-top: 20px; }

    .tool-card { 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        justify-content: center; 
        cursor: pointer; 
        transition: transform 0.2s, background-color 0.3s, border-color 0.3s; 
        padding: 15px; 
        background-color: var(--theme-surface-card); 
        border-radius: 8px; 
        border: 1px solid var(--theme-border); 
        position: relative;
    }
    .tool-card:hover { transform: translateY(-5px); }
    .tool-icon { margin-bottom: 10px; font-size: 48px !important; color: var(--theme-primary); transition: color 0.3s; } /* Important to override other styles */
    .tool-name { font-size: 14px; font-weight: 500; text-align: center; color: var(--theme-text); transition: color 0.3s; }

    /* Star icon on tool cards */
    .tool-card .star-icon {
        position: absolute;
        top: 8px;
        right: 8px;
        font-size: 20px;
        color: var(--theme-primary);
        display: none;
        transition: color 0.3s;
    }
    .tool-card.starred .star-icon {
        display: block;
    }

    /* Overlay for settings panel */
    .overlay { 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background-color: rgba(0,0,0,0.5); 
        display: none; 
        z-index: 999; 
        opacity: 0;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        transition: opacity 0.3s ease;
    }
    .overlay.active { 
        display: block; 
        opacity: 1;
    }
    
    /* Aurora Floating Box */
    .floating-box { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 10px; padding: 12px 20px; border-radius: 16px; background: var(--theme-surface-glass); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); box-shadow: 0 0 12px rgba(106, 0, 255, 0.4), 0 0 24px rgba(0, 157, 255, 0.3); border: 1.5px solid rgba(255, 255, 255, 0.4); text-decoration: none; z-index: 900; transition: transform 0.2s ease, box-shadow 0.3s ease, background-color 0.3s; }
    .floating-box:hover { transform: translateX(-50%) scale(1.03); box-shadow: 0 0 16px rgba(138, 43, 226, 0.5), 0 0 28px rgba(0, 191, 255, 0.4); }
    .floating-box .icon svg { width: 20px; height: 20px; stroke: var(--theme-text); stroke-width: 2; transition: stroke 0.3s; }
    .floating-box .text { font-size: 15px; color: var(--theme-text); font-weight: 500; transition: color 0.3s; }
    .floating-box .new-badge { background: linear-gradient(to right, #6a00ff, #00bfff); color: white; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 12px; }
    .dark-theme .floating-box .icon svg, .dark-theme .floating-box .text { stroke: #111; color: #111; } /* Specific for dark */


    /* --- NEW SETTINGS PANEL --- */
    #settingsPanel {
        position: fixed;
        top: 0;
        right: 0;
        width: 500px;
        max-width: 95vw;
        height: 100%;
        background-color: var(--theme-surface);
        z-index: 1000;
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out, background-color 0.3s;
        box-shadow: -5px 0 20px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }
    #settingsPanel.active {
        transform: translateX(0);
    }
    
    .settings-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid var(--theme-border);
        flex-shrink: 0;
    }
    .settings-header h2 {
        font-weight: 500;
        color: var(--theme-text);
    }
    .settings-close-btn {
        background: none;
        border: none;
        color: var(--theme-text-secondary);
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    .settings-close-btn:hover {
        background-color: var(--theme-hover-bg);
    }

    .settings-content {
        padding: 16px 24px;
        overflow-y: auto;
        flex-grow: 1;
    }
    
    .settings-section {
        margin-bottom: 24px;
        padding-bottom: 24px;
        border-bottom: 1px solid var(--theme-border);
    }
    .settings-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .settings-section h3 {
        font-size: 16px;
        font-weight: 500;
        color: var(--theme-text);
        margin-bottom: 16px;
    }
    
    #app-version {
        text-align: center;
        color: var(--theme-text-secondary);
        font-size: 14px;
        margin-top: -10px;
    }

    /* --- UPDATED: Account Section Styles --- */
    #account-details {
        display: flex;
        align-items: center;
        gap: 16px;
    }
    #accountPfpDisplay {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--theme-border);
    }
    .account-info {
        flex-grow: 1;
    }
    #accountNameDisplay {
        font-size: 16px;
        font-weight: 500;
        color: var(--theme-text);
    }
    #accountEmailDisplay {
        font-size: 14px;
        color: var(--theme-text-secondary);
        word-break: break-all;
    }
    .account-buttons {
        margin-top: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .account-btn {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        font-size: 15px;
        transition: background-color 0.2s, opacity 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    .account-btn.edit {
        background-color: var(--theme-hover-bg);
        color: var(--theme-text);
        border: 1px solid var(--theme-border);
    }
    .account-btn.edit:hover {
        background-color: var(--theme-border);
    }
    .account-btn.logout {
        background-color: #D32F2F;
        color: white;
    }
    .account-btn.logout:hover {
        background-color: #B71C1C;
    }
    /* --- END Account Section Styles --- */


    /* Logs Section */
    #settings-releaseContainer { 
        max-height: 250px; 
        overflow-y: auto; 
        padding-right: 6px; 
    }
    .settings-release-item { 
        background: var(--theme-surface-glass-hover); 
        border-radius: 12px; 
        padding: 12px 14px; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
        margin-bottom: 14px; 
        transition: background-color 0.3s;
    }
    .settings-release-item h4 { margin: 5px 0; font-size: 15px; font-weight: bold; color: var(--theme-text); }
    .settings-release-item small { color: var(--theme-text-secondary); display: block; margin-bottom: 8px; }
    .settings-release-item p { font-size: 13px; line-height: 1.4; color: var(--theme-text); }
    .settings-release-item a { text-decoration: none; color: var(--theme-primary); font-size: 13px; display: inline-block; margin-top: 6px; }
    
    #settings-releaseContainer::-webkit-scrollbar { width: 6px; }
    #settings-releaseContainer::-webkit-scrollbar-thumb { background: rgba(100, 100, 100, 0.3); border-radius: 4px; }
    #settings-releaseContainer::-webkit-scrollbar-thumb:hover { background: rgba(100, 100, 100, 0.5); }

    /* Toggle Switch */
    .toggle-switch {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .toggle-switch label {
        font-size: 14px;
        color: var(--theme-text);
    }
    .switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
    }
    .switch input { display: none; }
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }
    .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    input:checked + .slider {
        background-color: var(--theme-primary);
    }
    input:checked + .slider:before {
        transform: translateX(20px);
    }

    /* Starred Tools */
    #starred-tools-search {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--theme-border);
        border-radius: 8px;
        background-color: var(--theme-bg);
        color: var(--theme-text);
        margin-bottom: 12px;
    }
    #starred-tools-list {
        max-height: 200px;
        overflow-y: auto;
    }
    .starred-tool-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px;
        border-radius: 4px;
    }
    .starred-tool-item:hover {
        background-color: var(--theme-hover-bg);
    }
    .starred-tool-item span {
        font-size: 14px;
    }
    .star-toggle-btn {
        background: none;
        border: none;
        color: var(--theme-text-secondary);
        cursor: pointer;
        padding: 4px;
    }
    .star-toggle-btn.active {
        color: var(--theme-primary);
    }

    /* Theme Options (moved) */
    .theme-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 15px;
    }
    .theme-option {
        padding: 12px;
        border: 2px solid var(--theme-border);
        background: var(--theme-bg);
        color: var(--theme-text);
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        font-weight: 500;
        transition: all 0.2s;
        position: relative;
    }
    .theme-option:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .theme-option.active {
        border-color: var(--theme-primary);
        box-shadow: 0 0 10px var(--theme-primary);
    }
    .theme-option .material-symbols-outlined {
        font-size: 16px;
        vertical-align: middle;
        margin-right: 5px;
    }
    .custom-color-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    #customColorPicker {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 100%;
        height: 35px;
        background-color: transparent;
        border: none;
        cursor: pointer;
    }
    #customColorPicker::-webkit-color-swatch-wrapper { padding: 0; }
    #customColorPicker::-webkit-color-swatch { border: 2px solid var(--theme-border); border-radius: 8px; }
    #customColorPicker::-moz-color-swatch { border: 2px solid var(--theme-border); border-radius: 8px; }

    /* Background Animation */
    .bg-options {
        display: flex;
        gap: 10px;
        margin-bottom: 16px;
    }
    .bg-options label {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid var(--theme-border);
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        font-size: 14px;
    }
    .bg-options input { display: none; }
    .bg-options input:checked + label {
        background-color: var(--theme-primary);
        color: white;
        border-color: var(--theme-primary);
    }

    .bg-controls { display: none; }
    .bg-controls.active { display: block; }

    .bg-controls-group {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .bg-controls-group label {
        font-size: 14px;
    }
    .bg-controls-group input[type="color"] {
        width: 50px;
        height: 30px;
        border: 1px solid var(--theme-border);
        border-radius: 4px;
        padding: 2px;
    }
    .bg-btn {
        padding: 8px 12px;
        background-color: var(--theme-hover-bg);
        border: 1px solid var(--theme-border);
        color: var(--theme-text);
        border-radius: 8px;
        cursor: pointer;
    }
    .bg-btn:hover {
        opacity: 0.8;
    }

    #legal-iframe {
        width: 100%;
        height: 300px;
        border: 1px solid var(--theme-border);
        border-radius: 8px;
    }
    /* --- END SETTINGS PANEL --- */


    /* Responsive */
    @media (max-width: 768px) {
        .logo h1 { display: none; }
        .nav-items { gap: 15px; }
        .tools-container { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 20px; }
    }
    
    @media (max-width: 480px) {
        .section-header h3 {
             flex-basis: 100%; /* Title takes full width on small screens */
             margin-bottom: 10px; /* Add space below title */
             text-align: center;
        }
        .section-header .controls {
            flex-grow: 1;
            justify-content: center; /* Center controls on small screens */
        }
        .search-container.active .search-bar {
            width: 150px; /* Slightly smaller search on mobile */
        }
    }
</style>
</head>
<body>

    <!-- --- NEW: Account Page --- -->
    <div id="accountPage">
        <div class="account-form-container">
            <h2>Create Your DocuWrite Pro Account</h2>
            <div class="account-input-group">
                <label for="accountFullName">Full Name</label>
                <input type="text" id="accountFullName" placeholder="e.g., Jane Doe" required>
            </div>
            <div class="account-input-group">
                <label for="accountEmail">Email</label>
                <input type="email" id="accountEmail" placeholder="e.g., jane.doe@example.com" required>
            </div>
            <!-- --- UPDATED: PFP Input --- -->
            <div class="account-input-group">
                <label for="accountPfpUrl">Profile Picture URL</label>
                <input type="text" id="accountPfpUrl" placeholder="https://example.com/image.png">
            </div>
            <button id="createAccountBtn">Create Account</button>
            <p id="accountErrorMsg"></p>
        </div>
    </div>


    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="pulse">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    
    <!-- Header (Initially hidden) -->
    <header class="header hidden">
        <div class="left-section">
            <!-- Hamburger menu removed -->
        </div>
        
        <div class="nav-items">
            <span>DocuWrite Pro 4</span>
        </div>
        
        <div class="right-section" style="margin-left: auto;">
            <!-- Grid button removed -->
            <button class="settings-btn" id="settingsBtn" title="Settings">
                <span class="material-symbols-outlined">settings</span>
            </button>
        </div>
    </header>
    
    <!-- Main Content (Initially hidden) -->
    <main class="main-content hidden">
        
        <!-- --- NEW: Welcome Section --- -->
        <section class="welcome-section">
            <h2 id="welcomeGreeting">Welcome</h2>
        </section>
<hr>
	</br>
        <section class="new-document">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; flex-wrap: wrap; margin-bottom: 20px;">
                <h2 style="margin: 0;">Start a new document</h2>
                <!-- Theme icon removed, moved to settings -->
            </div>

            <div class="document-cards-container">
                <!-- 
                  Data attributes added for new tab functionality.
                  Original onclick="window.open(...)" removed.
                -->
                <div class="document-card" data-href="https://mahi902.github.io/DocuWritePro/document-writer.html">
                    <div class="document-icon"><span class="material-symbols-outlined plus-icon">add</span></div>
                    <div class="document-name">Blank Document</div>
                </div>
                <div class="document-card" data-href="https://mahi902.github.io/DocuWritePro/collab-document-editor.html">
                    <div class="document-icon"><span class="material-symbols-outlined plus-icon">group</span></div>
                    <div class="document-name">Collab</div>
                </div>
                <div class="document-card" data-href="https://mahi902.github.io/DocuWritePro/code-playground.html">
                    <div class="document-icon"><span class="material-symbols-outlined plus-icon">code</span></div>
                    <div class="document-name">Code Editor</div>
                </div>
                <div class="document-card" data-href="https://mahi902.github.io/DocuWritePro/image-editor.html">
                    <div class="document-icon"><span class="material-symbols-outlined plus-icon">collections</span></div>
                    <div class="document-name">Image Editor</div>
                </div>
            </div>
        </section>

        <section class="popular-tools">
            <div class="section-header">
                <h3>Popular Tools</h3>
                <div class="controls">
                    <div class="search-container" id="searchContainer">
                        <span class="material-symbols-outlined search-icon" id="searchIcon">search</span>
                        <input type="text" class="search-bar" id="toolSearch" placeholder="Search tools...">
                    </div>
                    <div class="organize-menu">
                        <span class="material-symbols-outlined organize-icon" onclick="toggleFilterOptions(event)">filter_list</span>
                        <div class="filter-options" id="filterOptions">
                            <span onclick="filterTools('All')">All</span>
                            <span onclick="filterTools('Document Editing')">Document Editing</span>
                            <span onclick="filterTools('Image Editing')">Image Editing</span>
                            <span onclick="filterTools('Code Editing')">Code Editing</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 
              Tool cards now have:
              - data-href (replaces onclick)
              - data-category (for filtering)
              - data-tool-id (for starring)
              - data-tool-name (for populating settings)
              - A star icon span
            -->
            <div class="tools-container" id="toolsContainer">
                 <!-- Document Editing Tools -->
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/document-writer.html" data-tool-id="editor" data-tool-name="Editor"><span class="material-symbols-outlined tool-icon">edit</span><div class="tool-name">Editor</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/viewer.html" data-tool-id="viewer" data-tool-name="Document Viewer"><span class="material-symbols-outlined tool-icon">visibility</span><div class="tool-name">Document Viewer</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/word-description-finder.html" data-tool-id="word-finder" data-tool-name="Word Finder"><span class="material-symbols-outlined tool-icon">menu_book</span><div class="tool-name">Word Finder</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/translator.html" data-tool-id="translator" data-tool-name="Translator"><span class="material-symbols-outlined tool-icon">language</span><div class="tool-name">Translator</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/document-signer.html" data-tool-id="signer" data-tool-name="Document Signer"><span class="material-symbols-outlined tool-icon">draw</span><div class="tool-name">Document Signer</div><span class="material-symbols-outlined star-icon">star</span></div>
				<div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/findandreplacer.html" data-tool-id="find-replace" data-tool-name="Find & Replacer"><span class="material-symbols-outlined tool-icon">find_replace</span><div class="tool-name">Find & Replacer</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/page-number-adder.html" data-tool-id="page-number" data-tool-name="Page Number Adder"><span class="material-symbols-outlined tool-icon">format_list_numbered</span><div class="tool-name">Page Number Adder</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/chart-maker.html" data-tool-id="chart-maker" data-tool-name="Chart Maker"><span class="material-symbols-outlined tool-icon">bar_chart</span><div class="tool-name">Chart Maker</div><span class="material-symbols-outlined star-icon">star</span></div>
				<div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/graphmaker.html" data-tool-id="graph-maker" data-tool-name="Graph Maker"><span class="material-symbols-outlined tool-icon">query_stats</span><div class="tool-name">Graph Maker</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/table-maker.html" data-tool-id="table-maker" data-tool-name="Table Maker"><span class="material-symbols-outlined tool-icon">table_chart</span><div class="tool-name">Table Maker</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/watermarker.html" data-tool-id="watermark" data-tool-name="Watermark Adder"><span class="material-symbols-outlined tool-icon">filter_alt</span><div class="tool-name">Watermark Adder</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/email-writer.html" data-tool-id="email-writer" data-tool-name="Email Writer"><span class="material-symbols-outlined tool-icon">email</span><div class="tool-name">Email Writer</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/spell-checker.html" data-tool-id="spell-check" data-tool-name="Spell Checker"><span class="material-symbols-outlined tool-icon">spellcheck</span><div class="tool-name">Spell Checker</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/file-extractor.html" data-tool-id="file-extractor" data-tool-name="File Extractor"><span class="material-symbols-outlined tool-icon">unarchive</span><div class="tool-name">File Extractor</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/qr-code-maker.html" data-tool-id="qr-maker" data-tool-name="QR Maker"><span class="material-symbols-outlined tool-icon">qr_code</span><div class="tool-name">QR Maker</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/id-card-maker.html" data-tool-id="id-card-maker" data-tool-name="ID Card Maker"><span class="material-symbols-outlined tool-icon">badge</span><div class="tool-name">ID Card Maker</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/file-zipper.html" data-tool-id="file-zipper" data-tool-name="File Zipper"><span class="material-symbols-outlined tool-icon">archive</span><div class="tool-name">File Zipper</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/converters.html" data-tool-id="pdf-converter" data-tool-name="PDF Converter"><span class="material-symbols-outlined tool-icon">picture_as_pdf</span><div class="tool-name">PDF Converter</div><span class="material-symbols-outlined star-icon">star</span></div>
				<div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/pdfcompressor.html" data-tool-id="pdf-compressor" data-tool-name="PDF Compressor"><span class="material-symbols-outlined tool-icon">compress</span><div class="tool-name">PDF Compressor</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/context-field.html" data-tool-id="context-field" data-tool-name="Context Field"><span class="material-symbols-outlined tool-icon">summarize</span><div class="tool-name">Context Field</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/gift-card-maker.html" data-tool-id="gift-card-maker" data-tool-name="Gift Card Maker"><span class="material-symbols-outlined tool-icon">card_giftcard</span><div class="tool-name">Gift Card Maker</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/docudrop.html" data-tool-id="docudrop" data-tool-name="Share File"><span class="material-symbols-outlined tool-icon">file_upload</span><div class="tool-name">Share File</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/text-extractor.html" data-tool-id="text-extractor" data-tool-name="Text Extractor"><span class="material-symbols-outlined tool-icon">document_scanner</span><div class="tool-name">Text Extractor</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Document Editing" data-href="https://mahi902.github.io/DocuWritePro/keyboard-click-test.html" data-tool-id="keyboard-test" data-tool-name="Keyboard Click Test"><span class="material-symbols-outlined tool-icon">keyboard</span><div class="tool-name">Keyboard Click Test</div><span class="material-symbols-outlined star-icon">star</span></div>
                <!-- Code Editing Tools -->
                <div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/frontend-ide.html" data-tool-id="frontend-ide" data-tool-name="Frontend IDE"><span class="material-symbols-outlined tool-icon">developer_mode</span><div class="tool-name">Frontend IDE</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/code-playground.html" data-tool-id="html-editor" data-tool-name="HTML Editor"><span class="material-symbols-outlined tool-icon">code</span><div class="tool-name">HTML Editor</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/html.html" data-tool-id="html-writer" data-tool-name="HTML Writer"><span class="material-symbols-outlined tool-icon">html</span><div class="tool-name">HTML Writer</div><span class="material-symbols-outlined star-icon">star</span></div>
				<div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/mdeditor.html" data-tool-id="md-editor" data-tool-name="Markdown Editor"><span class="material-symbols-outlined tool-icon">Markdown</span><div class="tool-name">Markdown Editor</div><span class="material-symbols-outlined star-icon">star</span></div>
                <!-- --- NEW: PHP Tool --- -->
                <div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/button-designer.html" data-tool-id="button-designer" data-tool-name="Button Designer"><span class="material-symbols-outlined tool-icon">smart_button</span><div class="tool-name">Button Designer</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/html-splitter.html" data-tool-id="html-splitter" data-tool-name="HTML Splitter"><span class="material-symbols-outlined tool-icon">integration_instructions</span><div class="tool-name">HTML Splitter</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/goto-code.html" data-tool-id="goto-code" data-tool-name="GoTo Code"><span class="material-symbols-outlined tool-icon">merge</span><div class="tool-name">GoTo Code</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Code Editing" data-href="https://mahi902.github.io/DocuWritePro/code-snipper.html" data-tool-id="code-snipper" data-tool-name="Code Snipper"><span class="material-symbols-outlined tool-icon">content_cut</span><div class="tool-name">Code Snipper</div><span class="material-symbols-outlined star-icon">star</span></div>
                <!-- Image Editing Tools -->
                <div class="tool-card" data-category="Image Editing" data-href="https://mahi902.github.io/DocuWritePro/image-editor.html" data-tool-id="image-editor" data-tool-name="Image Editor"><span class="material-symbols-outlined tool-icon">collections</span><div class="tool-name">Image Editor</div><span class="material-symbols-outlined star-icon">star</span></div>
				<div class="tool-card" data-category="Image Editing" data-href="https://mahi902.github.io/DocuWritePro/atbedt.html" data-tool-id="attribution-editor" data-tool-name="Attribution Editor"><span class="material-symbols-outlined tool-icon">display_settings</span><div class="tool-name">Attribution Editor</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Image Editing" data-href="https://mahi902.github.io/DocuWritePro/image-generator.html" data-tool-id="image-generator" data-tool-name="Image Generator"><span class="material-symbols-outlined tool-icon">auto_awesome</span><div class="tool-name">Image Generator</div><span class="material-symbols-outlined star-icon">star</span></div>
                <div class="tool-card" data-category="Image Editing" data-href="https://mahi902.github.io/DocuWritePro/draw.html" data-tool-id="drawing-board" data-tool-name="Drawing Board"><span class="material-symbols-outlined tool-icon">brush</span><div class="tool-name">Drawing Board</div><span class="material-symbols-outlined star-icon">star</span></div>
            </div>
        </section>
    </main>
    
    <!-- Old Sidebars and Log wrapper removed -->
    
    <div class="overlay" id="overlay"></div>

    <!-- Floating Widgets -->
    <greeting-bar></greeting-bar>
    
    
    <!-- === NEW SETTINGS PANEL === -->
    <div id="settingsPanel">
        <div class="settings-header">
            <h2>Settings</h2>
            <button class="settings-close-btn" id="settingsCloseBtn">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        
        <div class="settings-content">
            <div class="settings-section">
                <h3 style="text-align: center; margin-bottom: 5px;">DocuWrite Pro</h3>
			</br>
                <p id="app-version">Version 4.9.0</p>
            </div>
            
            <!-- --- UPDATED: Account Section --- -->
            <div class="settings-section hidden" id="account-section">
                <h3>Account</h3>
                <div id="account-details">
                    <img id="accountPfpDisplay" src="https://placehold.co/50x50/eee/333?text=?" alt="Profile Picture">
                    <div class="account-info">
                        <div id="accountNameDisplay">Loading...</div>
                        <div id="accountEmailDisplay">Loading...</div>
                    </div>
                </div>
                <div class="account-buttons">
                    <button id="editAccountBtn" class="account-btn edit">
                        <span class="material-symbols-outlined">edit</span>
                        Edit Account
                    </button>
                    <button id="logoutBtn" class="account-btn logout">
                        <span class="material-symbols-outlined">logout</span>
                        Log Out
                    </button>
                </div>
            </div>
            <!-- --- END: Account Section --- -->

            <div class="settings-section">
                <h3>Release Logs</h3>
                <div id="settings-releaseContainer"><p>Fetching releases...</p></div>
            </div>

            <div class="settings-section">
                <h3>Preferences</h3>
                <div class="toggle-switch">
                    <label for="newTabToggle">Open Links in New Tab</label>
                    <label class="switch">
                        <input type="checkbox" id="newTabToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3>Starred Tools</h3>
                <input type="text" id="starred-tools-search" placeholder="Search tools to star...">
                <div id="starred-tools-list">
                    <!-- Tool list will be populated by JS -->
                </div>
            </div>

            <div class="settings-section">
                <h3>Customize Theme</h3>
                <div class="theme-options">
                    <div class="theme-option" data-theme="light">
                        <span class="material-symbols-outlined">light_mode</span> Light
                    </div>
                    <div class="theme-option" data-theme="dark">
                        <span class="material-symbols-outlined">dark_mode</span> Dark
                    </div>
                    <div class="theme-option" data-theme="red">
                        <span class="material-symbols-outlined">format_paint</span> Red
                    </div>
                    <div class="theme-option" data-theme="blue">
                        <span class="material-symbols-outlined">format_paint</span> Blue
                    </div>
                    <div class="theme-option" data-theme="green">
                        <span class="material-symbols-outlined">format_paint</span> Green
                    </div>
                    <div class="theme-option" data-theme="custom">
                        <div class="custom-color-wrapper">
                            <span>Custom</span>
                            <input type="color" id="customColorPicker" value="#1a73e8">
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>Background</h3>
                <div class="bg-options">
                    <input type="radio" name="bg-type" id="bg-type-animation" value="animation" checked>
                    <label for="bg-type-animation">Animation</label>
                    
                    <input type="radio" name="bg-type" id="bg-type-gradient" value="gradient">
                    <label for="bg-type-gradient">Gradient</label>
                    
                    <input type="radio" name="bg-type" id="bg-type-solid" value="solid">
                    <label for="bg-type-solid">Solid</label>
                </div>

                <div id="bg-controls-animation" class="bg-controls active">
                    <button id="bg-pause-btn" class="bg-btn">Pause</button>
                    <button id="bg-play-btn" class="bg-btn" style="display: none;">Play</button>
                </div>

                <div id="bg-controls-gradient" class="bg-controls">
                    <div class="bg-controls-group" style="margin-bottom: 10px;">
                        <label for="bg-grad-color-1">Color 1:</label>
                        <input type="color" id="bg-grad-color-1" value="#f5f7fa">
                        <label for="bg-grad-color-2">Color 2:</label>
                        <input type="color" id="bg-grad-color-2" value="#e4edf9">
                    </div>
                    <div class="bg-controls-group">
                        <label for="bg-grad-direction">Direction:</label>
                        <select id="bg-grad-direction" class="bg-btn">
                            <option value="to right">Left to Right</option>
                            <option value="to bottom">Top to Bottom</option>
                            <option value="135deg">Diagonal</option>
                        </select>
                    </div>
                </div>

                <div id="bg-controls-solid" class="bg-controls">
                    <div class="bg-controls-group">
                        <label for="bg-solid-color">Color:</label>
                        <input type="color" id="bg-solid-color" value="#f8f9fa">
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>Legal</h3>
                <iframe id="legal-iframe" src="https://mahi902.github.io/DocuWritePro/legal-documents.html"></iframe>
            </div>
        </div>
    </div>
    
    <script>
        // --- Greeting Bar Web Component ---
        class GreetingBar extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.shadowRoot.innerHTML = `
                    <style>
                      :host { all: initial; position: fixed; top: 0; left: 0; width: 100vw; display: flex; justify-content: center; z-index: 999; font-family: system-ui, sans-serif; user-select: none; }
                      .bar { position: relative; width: 320px; max-width: 90vw; margin-top: 1.2rem; background: rgba(255 255 255 / 0.65); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 10px; box-shadow: 0 0 8px rgba(255, 255, 255, 0.75), 0 0 15px rgba(0, 123, 255, 0.6); color: #111; font-size: 1rem; font-weight: 600; padding: 0.7rem 1.2rem; display: flex; align-items: center; overflow: hidden; cursor: pointer; transform: translateY(-120%); opacity: 0; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease; user-select: none; }
                      .bar.show { transform: translateY(0); opacity: 1; }
                      .glow { position: absolute; top: 0; left: -50%; width: 50%; height: 100%; pointer-events: none; background: linear-gradient(90deg, transparent, rgba(0, 123, 255, 0.4), transparent); filter: drop-shadow(0 0 6px #007bff); animation: glowMove 1s forwards; will-change: left, opacity; }
                      @keyframes glowMove { 0% { left: -50%; opacity: 0; } 10% { opacity: 1; } 90% { left: 150%; opacity: 1; } 100% { left: 150%; opacity: 0; } }
                    </style>
                    <div class="bar" part="bar" role="alert" tabindex="0" aria-live="polite">
                      <div class="glow"></div>
                      <span class="text">Hello!</span>
                    </div>
                `;
                this.bar = this.shadowRoot.querySelector('.bar');
                this.textSpan = this.shadowRoot.querySelector('.text');
                this.dismiss = this.dismiss.bind(this);
            }
            connectedCallback() { this.setGreeting(); this.showBar(); setTimeout(this.dismiss, 1000); this.bar.addEventListener('click', this.dismiss); }
            disconnectedCallback() { this.bar.removeEventListener('click', this.dismiss); }
            setGreeting() { this.textSpan.textContent = " Connected"; }
            showBar() { requestAnimationFrame(() => this.bar.classList.add('show')); }
            dismiss() { this.bar.style.transition = 'transform 0.4s ease, opacity 0.4s ease'; this.bar.style.transform = 'translateY(-120%)'; this.bar.style.opacity = '0'; setTimeout(() => this.remove(), 400); }
        }
        customElements.define('greeting-bar', GreetingBar);

        // --- Main Dashboard Script ---
        
        // --- Global Variables ---
        const body = document.body;
        let allToolsData = [];
        let starredTools = [];

        // --- NEW: Cookie Helper Functions ---
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            // Use encodeURIComponent for value
            document.cookie = name + "=" + (encodeURIComponent(value) || "") + expires + "; path=/; SameSite=Lax";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) {
                    // Use decodeURIComponent to get the original value
                    return decodeURIComponent(c.substring(nameEQ.length, c.length));
                }
            }
            return null;
        }


        // --- THEME MANAGEMENT ---
        const themeOptions = document.querySelectorAll('.theme-option');
        const customColorPicker = document.getElementById('customColorPicker');

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        function isColorDark(color) {
            const r = parseInt(color.substr(1,2), 16);
            const g = parseInt(color.substr(3,2), 16);
            const b = parseInt(color.substr(5,2), 16);
            const brightness = (r * 0.299 + g * 0.587 + b * 0.114);
            return brightness < 150;
        }

        function updateActiveThemeButton(themeName) {
            themeOptions.forEach(opt => {
                if (opt.dataset.theme === themeName) {
                    opt.classList.add('active');
                } else {
                    opt.classList.remove('active');
                }
            });
        }
        
        function applyTheme(themeName) {
            body.classList.remove('dark-theme', 'red-theme', 'blue-theme', 'green-theme', 'custom-theme');
            const customStyleTag = document.getElementById('custom-theme-styles');
            if (customStyleTag) {
                customStyleTag.innerHTML = '';
            }
            if (themeName !== 'light') {
                body.classList.add(`${themeName}-theme`);
            }
            localStorage.setItem('theme', themeName);
            updateActiveThemeButton(themeName);
        }

        function applyCustomTheme(color) {
            const isDark = isColorDark(color);
            const textColor = isDark ? '#f1f1f1' : '#1b5e20';
            const textSecColor = isDark ? '#aaa' : '#2e7d32';
            const bgColor = isDark ? '#121212' : '#e8f5e9';
            const surfaceColor = isDark ? '#1f1f1f' : '#c8e6c9';
            const borderColor = isDark ? '#333' : '#a5d6a7';
            const hoverBg = isDark ? '#333' : '#81c784';
            
            const customStyles = `
                body.custom-theme {
                    --theme-bg: ${bgColor};
                    --theme-surface: ${surfaceColor};
                    --theme-surface-glass: ${hexToRgba(color, 0.1)};
                    --theme-surface-glass-hover: ${hexToRgba(color, 0.2)};
                    --theme-surface-tools: ${surfaceColor};
                    --theme-surface-card: ${isDark ? surfaceColor : bgColor};
                    --theme-text: ${textColor};
                    --theme-text-secondary: ${textSecColor};
                    --theme-border: ${borderColor};
                    --theme-primary: ${color};
                    --theme-primary-hover: ${color};
                    --theme-hover-bg: ${hoverBg};
                    --theme-logo-color: ${textColor};
                    --bg-grad-1: ${isDark ? '#111' : bgColor};
                    --bg-grad-2: ${isDark ? '#222' : surfaceColor};
                    --bg-bubble: ${hexToRgba(color, 0.1)};
                    --bg-pulse: ${hexToRgba(color, 0.1)};
                    --bg-particle-1: ${color};
                    --bg-particle-2: ${color};
                }
            `;
            
            let styleTag = document.getElementById('custom-theme-styles');
            if (!styleTag) {
                styleTag = document.createElement('style');
                styleTag.id = 'custom-theme-styles';
                document.head.appendChild(styleTag);
            }
            styleTag.innerHTML = customStyles;

            body.classList.remove('dark-theme', 'red-theme', 'blue-theme', 'green-theme');
            body.classList.add('custom-theme');
            
            localStorage.setItem('theme', 'custom');
            localStorage.setItem('customThemeColor', color);
            updateActiveThemeButton('custom');
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const savedCustomColor = localStorage.getItem('customThemeColor') || '#1a73e8';
            customColorPicker.value = savedCustomColor;
            if (savedTheme === 'custom') {
                applyCustomTheme(savedCustomColor);
            } else {
                applyTheme(savedTheme);
            }
        }
        
        // --- BACKGROUND MANAGEMENT ---
        const bgTypeRadios = document.querySelectorAll('input[name="bg-type"]');
        const bgControls = document.querySelectorAll('.bg-controls');
        const animatedBg = document.querySelector('.animated-bg');
        const bgPauseBtn = document.getElementById('bg-pause-btn');
        const bgPlayBtn = document.getElementById('bg-play-btn');
        const bgGradColor1 = document.getElementById('bg-grad-color-1');
        const bgGradColor2 = document.getElementById('bg-grad-color-2');
        const bgGradDirection = document.getElementById('bg-grad-direction');
        const bgSolidColor = document.getElementById('bg-solid-color');

        function applyBackgroundSettings() {
            const bgType = localStorage.getItem('bgType') || 'animation';
            const bgState = localStorage.getItem('bgState') || 'play';
            const color1 = localStorage.getItem('bgGradColor1') || '#f5f7fa';
            const color2 = localStorage.getItem('bgGradColor2') || '#e4edf9';
            const direction = localStorage.getItem('bgGradDirection') || '135deg';
            const solidColor = localStorage.getItem('bgSolidColor') || '#f8f9fa';

            // Set control values
            document.getElementById(`bg-type-${bgType}`).checked = true;
            bgGradColor1.value = color1;
            bgGradColor2.value = color2;
            bgGradDirection.value = direction;
            bgSolidColor.value = solidColor;

            // Hide all controls, show the active one
            bgControls.forEach(c => c.classList.remove('active'));
            document.getElementById(`bg-controls-${bgType}`).classList.add('active');

            // Apply styles
            if (bgType === 'animation') {
                animatedBg.style.background = ''; // Use CSS default
                if (bgState === 'play') {
                    body.classList.remove('bg-animation-paused');
                    bgPauseBtn.style.display = 'inline-block';
                    bgPlayBtn.style.display = 'none';
                } else {
                    body.classList.add('bg-animation-paused');
                    bgPauseBtn.style.display = 'none';
                    bgPlayBtn.style.display = 'inline-block';
                }
            } else if (bgType === 'gradient') {
                animatedBg.style.background = `linear-gradient(${direction}, ${color1}, ${color2})`;
                body.classList.add('bg-animation-paused'); // Pause animation
            } else if (bgType === 'solid') {
                animatedBg.style.background = solidColor;
                body.classList.add('bg-animation-paused'); // Pause animation
            }
        }

        // --- PREFERENCES (New Tab) ---
        const newTabToggle = document.getElementById('newTabToggle');

        function loadNewTabSetting() {
            const openInNewTab = localStorage.getItem('openInNewTab') !== 'false'; // Default to true
            newTabToggle.checked = openInNewTab;
        }

        function handleLinkClick(e) {
            const card = e.target.closest('[data-href]');
            if (!card) return;

            e.preventDefault();
            const href = card.dataset.href;
            const openInNewTab = newTabToggle.checked;

            if (openInNewTab) {
                window.open(href, '_blank');
            } else {
                window.location.href = href;
            }
        }
        
        // --- STARRING TOOLS ---
        const toolsContainer = document.getElementById('toolsContainer');
        const settingsStarredList = document.getElementById('starred-tools-list');
        const settingsStarredSearch = document.getElementById('starred-tools-search');

        function loadStarredTools() {
            starredTools = JSON.parse(localStorage.getItem('starredTools')) || [];
        }

        function populateAllToolsData() {
            const toolCards = document.querySelectorAll('#toolsContainer .tool-card');
            toolCards.forEach(card => {
                allToolsData.push({
                    id: card.dataset.toolId,
                    name: card.dataset.toolName,
                    category: card.dataset.category,
                    href: card.dataset.href,
                    element: card
                });
            });
        }
        
        function renderToolsOnMainPage() {
            const fragment = document.createDocumentFragment();
            const starredFragment = document.createDocumentFragment();

            allToolsData.forEach(tool => {
                if (starredTools.includes(tool.id)) {
                    tool.element.classList.add('starred');
                    starredFragment.appendChild(tool.element);
                } else {
                    tool.element.classList.remove('starred');
                    fragment.appendChild(tool.element);
                }
            });
            toolsContainer.innerHTML = '';
            toolsContainer.appendChild(starredFragment);
            toolsContainer.appendChild(fragment);
        }

        function renderStarredToolsInSettings(filter = '') {
            settingsStarredList.innerHTML = '';
            const lowerFilter = filter.toLowerCase();

            allToolsData
                .filter(tool => tool.name.toLowerCase().includes(lowerFilter))
                .forEach(tool => {
                    const isStarred = starredTools.includes(tool.id);
                    const item = document.createElement('div');
                    item.className = 'starred-tool-item';
                    item.innerHTML = `
                        <span>${tool.name}</span>
                        <button class="star-toggle-btn ${isStarred ? 'active' : ''}" data-tool-id="${tool.id}">
                            <span class="material-symbols-outlined">${isStarred ? 'star' : 'star_outline'}</span>
                        </button>
                    `;
                    settingsStarredList.appendChild(item);
                });
        }
        
        function toggleStar(toolId) {
            const index = starredTools.indexOf(toolId);
            if (index > -1) {
                starredTools.splice(index, 1); // Unstar
            } else {
                starredTools.push(toolId); // Star
            }
            localStorage.setItem('starredTools', JSON.stringify(starredTools));
            
            renderToolsOnMainPage();
            renderStarredToolsInSettings(settingsStarredSearch.value);
        }

        // --- SETTINGS PANEL ---
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const settingsCloseBtn = document.getElementById('settingsCloseBtn');
        const overlay = document.getElementById('overlay');
        let logsFetched = false;

        function openSettings() {
            settingsPanel.classList.add('active');
            overlay.classList.add('active');
            
            // Fetch logs only once
            if (!logsFetched) {
                fetchGitHubReleases();
                logsFetched = true;
            }
        }

        function closeSettings() {
            settingsPanel.classList.remove('active');
            overlay.classList.remove('active');
        }
        
        // --- GITHUB LOGS (Moved) ---
        function fetchGitHubReleases() {
            const container = document.getElementById('settings-releaseContainer');
            fetch("https://api.github.com/repos/mahi902/DocuWritePro/releases")
              .then(res => res.json())
              .then(data => {
                  if (!data || !data.length) { container.innerHTML = "<p>No releases found yet.</p>"; return; }
                  container.innerHTML = "";
                  data.slice(0, 10).forEach(release => { // Show 10 latest
                      const item = document.createElement("div");
                      item.className = "settings-release-item";
                      let bodyText = "No description provided.";
                      if (release.body) {
                          bodyText = release.body.replace(/\r\n/g, "<br>");
                      }
                      item.innerHTML = `
                          <h4>${release.name || "Untitled Release"}</h4>
                          <small>Published on: ${new Date(release.published_at).toLocaleDateString()}</small>
                          <p>${bodyText}</p>
                          <a href="${release.html_url}" target="_blank">View on GitHub </a>
                      `;
                      container.appendChild(item);
                  });
              })
              .catch(err => {
                  console.error("Error fetching releases:", err);
                  container.innerHTML = "<p>Unable to fetch release data.</p>";
              });
        }


        // --- DOMContentLoaded - Main Setup ---
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- NEW: Account Management Elements ---
            const accountPage = document.getElementById('accountPage');
            const createAccountBtn = document.getElementById('createAccountBtn');
            const accountFullName = document.getElementById('accountFullName');
            const accountEmail = document.getElementById('accountEmail');
            const accountPfpUrl = document.getElementById('accountPfpUrl'); // UPDATED
            const accountErrorMsg = document.getElementById('accountErrorMsg');
            
            const accountSection = document.getElementById('account-section');
            const accountPfpDisplay = document.getElementById('accountPfpDisplay');
            const accountNameDisplay = document.getElementById('accountNameDisplay');
            const accountEmailDisplay = document.getElementById('accountEmailDisplay');
            const editAccountBtn = document.getElementById('editAccountBtn'); // NEW
            const logoutBtn = document.getElementById('logoutBtn');
            
            const mainContent = document.querySelector('.main-content');
            const header = document.querySelector('.header');
            const welcomeGreeting = document.getElementById('welcomeGreeting'); // NEW

            // --- NEW: Account Logic ---
            function checkLoginState() {
                const userEmail = getCookie('userEmail');
                
                if (userEmail) {
                    // User is logged in
                    const userName = getCookie('userName');
                    const userPfp = getCookie('userPfp');

                    // Populate settings panel
                    if (userPfp) {
                        accountPfpDisplay.src = userPfp;
                        // Add error handler for broken links
                        accountPfpDisplay.onerror = () => {
                            accountPfpDisplay.src = 'https://placehold.co/50x50/eee/333?text=X';
                        };
                    } else {
                        accountPfpDisplay.src = 'https://placehold.co/50x50/eee/333?text=?';
                    }
                    accountNameDisplay.textContent = userName || 'User';
                    accountEmailDisplay.textContent = userEmail;
                    
                    // NEW: Populate welcome greeting
                    welcomeGreeting.textContent = `Welcome, ${userName || 'User'}!`;

                    // Show/Hide elements
                    accountSection.classList.remove('hidden');
                    accountPage.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    header.classList.remove('hidden');
                } else {
                    // User is not logged in
                    accountSection.classList.add('hidden');
                    accountPage.classList.remove('hidden');
                    mainContent.classList.add('hidden');
                    header.classList.add('hidden');
                }
            }

            createAccountBtn.addEventListener('click', () => {
                const name = accountFullName.value.trim();
                const email = accountEmail.value.trim();
                const pfpUrl = accountPfpUrl.value.trim(); // UPDATED
                
                if (!name || !email) {
                    accountErrorMsg.textContent = 'Please enter your name and email.';
                    return;
                }
                
                // UPDATED: Check for URL instead of file
                if (!pfpUrl) {
                    accountErrorMsg.textContent = 'Please enter a profile picture URL.';
                    return;
                }
                
                accountErrorMsg.textContent = '';
                
                // UPDATED: Save URL directly to cookie
                setCookie('userName', name, 30);
                setCookie('userEmail', email, 30);
                setCookie('userPfp', pfpUrl, 30);
                
                // Re-run login check to update UI
                checkLoginState();
            });

            function handleLogout() {
                // Expire cookies by setting a past date
                setCookie('userName', '', -1);
                setCookie('userEmail', '', -1);
                setCookie('userPfp', '', -1);
                
                // Re-run login check to show account page
                checkLoginState();
            }

            logoutBtn.addEventListener('click', handleLogout);
            editAccountBtn.addEventListener('click', handleLogout); // NEW: Edit button logs out


            // --- Settings Panel ---
            settingsBtn.addEventListener('click', openSettings);
            settingsCloseBtn.addEventListener('click', closeSettings);
            overlay.addEventListener('click', closeSettings);

            // --- Theme Setup ---
            loadTheme();
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const themeName = option.dataset.theme;
                    if (themeName !== 'custom') {
                        applyTheme(themeName);
                    } else {
                        customColorPicker.click(); 
                        applyCustomTheme(customColorPicker.value);
                    }
                });
            });
            customColorPicker.addEventListener('input', (e) => applyCustomTheme(e.target.value));

            // --- Background Setup ---
            applyBackgroundSettings();
            bgTypeRadios.forEach(radio => radio.addEventListener('change', (e) => {
                localStorage.setItem('bgType', e.target.value);
                applyBackgroundSettings();
            }));
            bgPauseBtn.addEventListener('click', () => {
                localStorage.setItem('bgState', 'pause');
                applyBackgroundSettings();
            });
            bgPlayBtn.addEventListener('click', () => {
                localStorage.setItem('bgState', 'play');
                applyBackgroundSettings();
            });
            bgGradColor1.addEventListener('input', (e) => {
                localStorage.setItem('bgGradColor1', e.target.value);
                applyBackgroundSettings();
            });
            bgGradColor2.addEventListener('input', (e) => {
                localStorage.setItem('bgGradColor2', e.target.value);
                applyBackgroundSettings();
            });
            bgGradDirection.addEventListener('change', (e) => {
                localStorage.setItem('bgGradDirection', e.target.value);
                applyBackgroundSettings();
            });
            bgSolidColor.addEventListener('input', (e) => {
                localStorage.setItem('bgSolidColor', e.target.value);
                applyBackgroundSettings();
            });
            
            // --- New Tab Preference ---
            loadNewTabSetting();
            newTabToggle.addEventListener('change', (e) => {
                localStorage.setItem('openInNewTab', e.target.checked);
            });

            // --- Starred Tools Setup ---
            populateAllToolsData();
            loadStarredTools();
            renderToolsOnMainPage();
            renderStarredToolsInSettings();

            settingsStarredSearch.addEventListener('keyup', (e) => {
                renderStarredToolsInSettings(e.target.value);
            });
            settingsStarredList.addEventListener('click', (e) => {
                const btn = e.target.closest('.star-toggle-btn');
                if (btn) {
                    toggleStar(btn.dataset.toolId);
                }
            });

            // --- Link Click Handler ---
            // Add listeners for all cards that open links
            document.querySelector('.document-cards-container').addEventListener('click', handleLinkClick);
            toolsContainer.addEventListener('click', handleLinkClick);

            // --- Animated background particles ---
            const bg = document.querySelector('.animated-bg');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 8 + 2 + 'px';
                particle.style.height = particle.style.width;
                particle.style.background = i % 2 === 0 ? 'var(--bg-particle-1)' : 'var(--bg-particle-2)';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.left = Math.random() * 100 + 'vw';
                bg.appendChild(particle);
                animateParticle(particle);
            }
            
            function animateParticle(el) {
                const duration = Math.random() * 10 + 10;
                const xDirection = Math.random() > 0.5 ? 1 : -1;
                const yDirection = Math.random() > 0.5 ? 1 : -1;
                el.animate([
                    { transform: `translate(0, 0)`, opacity: 0.3 },
                    { transform: `translate(${Math.random() * 100 * xDirection}px, ${Math.random() * 50 * yDirection}px)`, opacity: 0 }
                ], { duration: duration * 1000, iterations: Infinity, easing: 'ease-in-out' });
            }

            // --- Water drop click effect ---
            document.addEventListener('click', function(e) {
                // Do not create drop effect if clicking on an interactive icon or inside the settings panel or account page
                if (e.target.matches('.material-symbols-outlined') || e.target.closest('button') || e.target.closest('#settingsPanel') || e.target.closest('#accountPage')) {
                    return;
                }
                const drop = document.createElement('div');
                drop.classList.add('water-drop');
                drop.style.left = `${e.clientX - 25}px`;
                drop.style.top = `${e.clientY - 25}px`;
                drop.style.width = '50px';
                drop.style.height = '50px';
                document.body.appendChild(drop);
                setTimeout(() => drop.remove(), 1000);
            });
            
            // --- Search Bar Logic ---
            const searchIcon = document.getElementById('searchIcon');
            const searchContainer = document.getElementById('searchContainer');
            const searchBar = document.getElementById('toolSearch');

            searchIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                searchContainer.classList.toggle('active');
                if (searchContainer.classList.contains('active')) {
                    searchBar.focus();
                }
            });
            
            searchBar.addEventListener('click', (e) => e.stopPropagation());

            searchBar.addEventListener('keyup', () => {
                const searchTerm = searchBar.value.toLowerCase().trim();
                const toolCards = document.querySelectorAll("#toolsContainer .tool-card");
                
                toolCards.forEach(card => {
                    const toolName = card.dataset.toolName.toLowerCase();
                    const category = card.dataset.category.toLowerCase();
                    
                    if (toolName.includes(searchTerm) || category.includes(searchTerm)) {
                        card.style.display = "flex";
                    } else {
                        card.style.display = "none";
                    }
                });
                document.getElementById("filterOptions").classList.remove("show");
            });
            
            // --- Global click listener ---
            window.addEventListener('click', function(event) {
                // Don't close popups if the settings panel is active
                if (settingsPanel.classList.contains('active')) return;

                const filterDropdown = document.getElementById("filterOptions");
                if (!event.target.matches('.organize-icon') && filterDropdown.classList.contains('show')) {
                    filterDropdown.classList.remove('show');
                }
                
                if (!searchContainer.contains(event.target) && searchContainer.classList.contains('active')) {
                    searchContainer.classList.remove('active');
                }
            });

            // --- NEW: Initial Login Check ---
            checkLoginState();

        });

        // --- Tool Filtering Logic (Global) ---
        function toggleFilterOptions(event) {
            event.stopPropagation();
            document.getElementById("filterOptions").classList.toggle("show");
            
            const searchContainer = document.getElementById('searchContainer');
            const searchBar = document.getElementById('toolSearch');
            if (searchContainer.classList.contains('active')) {
                searchContainer.classList.remove('active');
                searchBar.value = '';
                filterTools('All'); // Reset list
            }
        }

        function filterTools(category) {
            const toolCards = document.querySelectorAll("#toolsContainer .tool-card");
            document.getElementById('toolSearch').value = '';
            
            toolCards.forEach(card => {
                if (category === "All" || card.dataset.category === category) {
                    card.style.display = "flex";
                } else {
                    card.style.display = "none";
                }
            });
            document.getElementById("filterOptions").classList.remove("show");
        }
    </script>
</body>
</html>
