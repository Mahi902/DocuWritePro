<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>About DocuWrite Pro</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />
    <style>
        :root {
            --bg-body: #F2F2F7;
            --bg-card: #FFFFFF;
            --text-primary: #000000;
            --text-secondary: #8E8E93;
            --separator: #E5E5EA;
            --primary-color: #007AFF;
        }

        html[data-theme="dark"] {
            --bg-body: #000000;
            --bg-card: #1C1C1E;
            --text-primary: #FFFFFF;
            --text-secondary: #98989D;
            --separator: #38383A;
            --primary-color: #0A84FF;
        }

        body {
            margin: 0; padding: 20px 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* App title header */
        .app-header {
            text-align: center;
            padding: 24px 16px 28px;
        }

        .app-title {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: var(--text-primary);
            margin: 0;
            min-height: 34px;
        }

        .app-title.loading {
            color: var(--text-secondary);
            font-weight: 400;
            font-size: 18px;
        }

        /* Settings-style UI */
        .settings-group {
            background: var(--bg-card);
            border-radius: 12px;
            margin: 0 16px 20px 16px;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .setting-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px 20px;
            cursor: pointer;
            position: relative;
            text-decoration: none;
            color: inherit;
        }

        .setting-row:not(:last-child)::after {
            content: ""; position: absolute; bottom: 0; right: 0;
            width: calc(100% - 20px); height: 1px; background: var(--separator);
        }

        .setting-row:active { background: var(--separator); }

        .setting-label { font-size: 16px; font-weight: 500; }
        .setting-chevron { color: var(--text-secondary); font-size: 20px; opacity: 0.5; }

        .section-title {
            margin: 0 0 8px 32px;
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        /* What's New sheet */
        .sheet-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 100;
            align-items: flex-end;
        }

        .sheet-overlay.open {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }

        .sheet {
            background: var(--bg-card);
            border-radius: 16px 16px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            padding: 0 0 env(safe-area-inset-bottom, 20px);
            animation: slideUp 0.3s cubic-bezier(0.32, 0.72, 0, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(100%) }
            to { transform: translateY(0) }
        }

        .sheet-handle {
            width: 36px; height: 5px;
            background: var(--separator);
            border-radius: 3px;
            margin: 12px auto 0;
        }

        .sheet-header {
            padding: 20px 20px 12px;
            border-bottom: 1px solid var(--separator);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .sheet-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .sheet-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 4px 0 0;
        }

        .sheet-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--bg-body);
            border: none;
            border-radius: 50%;
            width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 18px;
        }

        .sheet-close:active { opacity: 0.6; }

        .sheet-content {
            padding: 16px 20px 24px;
            user-select: text;
        }

        /* Markdown rendering */
        .md-body {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .md-body h1, .md-body h2 {
            font-size: 17px;
            font-weight: 600;
            margin: 18px 0 6px;
            color: var(--text-primary);
        }

        .md-body h3 {
            font-size: 15px;
            font-weight: 600;
            margin: 14px 0 4px;
            color: var(--text-primary);
        }

        .md-body p { margin: 6px 0; }
        .md-body ul, .md-body ol { padding-left: 20px; margin: 6px 0; }
        .md-body li { margin: 3px 0; }

        .md-body code {
            font-family: "SF Mono", Menlo, monospace;
            font-size: 13px;
            background: var(--bg-body);
            padding: 1px 5px;
            border-radius: 4px;
        }

        .md-body pre {
            background: var(--bg-body);
            border-radius: 8px;
            padding: 12px;
            overflow-x: auto;
        }

        .md-body pre code { background: none; padding: 0; }
        .md-body strong { font-weight: 600; }
        .md-body em { font-style: italic; }

        .md-body hr {
            border: none;
            border-top: 1px solid var(--separator);
            margin: 14px 0;
        }

        .md-loading {
            color: var(--text-secondary);
            font-size: 15px;
            text-align: center;
            padding: 20px 0;
        }

        /* Help section in sheet */
        .sheet-footer {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--separator);
        }

        .help-trigger {
            font-size: 14px;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 500;
            display: inline-block;
        }

        .help-trigger:active { opacity: 0.6; }

        .help-box {
            display: none;
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-secondary);
            background: var(--bg-body);
            padding: 12px;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <!-- App Title -->
    <div class="app-header">
        <h1 class="app-title loading" id="appTitle">Loading…</h1>
    </div>

    <!-- General Section -->
    <h3 class="section-title">General</h3>
    <div class="settings-group">
        <div class="setting-row" id="whatsNewRow">
            <span class="setting-label">What's New</span>
            <span class="material-symbols-rounded setting-chevron">chevron_right</span>
        </div>
    </div>

    <!-- Legal & Resources Section -->
    <h3 class="section-title">Legal &amp; Resources</h3>
    <div class="settings-group">
        <a href="https://mahi902.github.io/DocuWritePro/mit.md" class="setting-row">
            <span class="setting-label">License</span>
            <span class="material-symbols-rounded setting-chevron">chevron_right</span>
        </a>
        <a href="https://mahi902.github.io/DocuWritePro/tos.md" class="setting-row">
            <span class="setting-label">Terms of Service</span>
            <span class="material-symbols-rounded setting-chevron">chevron_right</span>
        </a>
        <a href="https://mahi902.github.io/DocuWritePro/privacypolicy.md" class="setting-row">
            <span class="setting-label">Privacy Policy</span>
            <span class="material-symbols-rounded setting-chevron">chevron_right</span>
        </a>
        <a href="https://mahi902.github.io/DocuWritePro/tpn.md" class="setting-row">
            <span class="setting-label">Third Party Notices</span>
            <span class="material-symbols-rounded setting-chevron">chevron_right</span>
        </a>
    </div>

    <!-- What's New Sheet -->
    <div class="sheet-overlay" id="whatsNewOverlay">
        <div class="sheet" id="whatsNewSheet">
            <div class="sheet-handle"></div>
            <div class="sheet-header">
                <p class="sheet-title" id="sheetTitle">What's New</p>
                <p class="sheet-subtitle" id="sheetSubtitle"></p>
                <button class="sheet-close" id="sheetCloseBtn">
                    <span class="material-symbols-rounded" style="font-size:18px;">close</span>
                </button>
            </div>
            <div class="sheet-content">
                <div class="md-body" id="mdContent">
                    <p class="md-loading">Loading…</p>
                </div>
                
                <!-- Help Text Section -->
                <div class="sheet-footer">
                    <div class="help-trigger" id="helpTrigger">App not updated?</div>
                    <div class="help-box" id="helpBox">
                        Please first confirm if your app is up to date. To do this, go to settings and scroll to the bottom, if the app version included there doesn't match the version shown above, your app is not updated. If your app still doesn't have the latest updates, please wait patiently, updates arrive automatically within a few hours. If not, use the "Reset & Update App" button in the settings.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- THEME SYNC ---
        function syncTheme() {
            const savedTheme = localStorage.getItem('theme_pref') || 'system';
            if (savedTheme === 'dark' || (savedTheme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
        }
        syncTheme();
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', syncTheme);

        // --- FETCH APP TITLE ---
        let appTitle = 'DocuWrite Pro'; 

        async function fetchAppTitle() {
            try {
                const res = await fetch('https://mahi902.github.io/DocuWritePro/app.html');
                const text = await res.text();
                const doc = new DOMParser().parseFromString(text, 'text/html');
                const title = doc.querySelector('title')?.innerText || doc.querySelector('title')?.textContent;
                if (title) appTitle = title.trim();
            } catch (e) {}
            const el = document.getElementById('appTitle');
            el.textContent = appTitle;
            el.classList.remove('loading');
        }

        fetchAppTitle();

        // --- MARKDOWN RENDERER ---
        function renderMarkdown(md) {
            let html = md
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/```[\s\S]*?```/g, m => {
                    const inner = m.slice(3, -3).replace(/^\w+\n/, '');
                    return `<pre><code>${inner}</code></pre>`;
                })
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/^---+$/gm, '<hr>')
                .replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/^[-*] (.+)$/gm, '<li>$1</li>')
                .replace(/^\d+\. (.+)$/gm, '<li>$1</li>')
                .replace(/(<li>[\s\S]*?<\/li>(\n|$))+/g, m => `<ul>${m}</ul>`)
                .replace(/^(?!<[a-z]|\s*$)(.+)$/gm, '<p>$1</p>')
                .replace(/\n{2,}/g, '\n');
            return html;
        }

        // --- WHAT'S NEW SHEET & HELP LOGIC ---
        const overlay = document.getElementById('whatsNewOverlay');
        const mdContent = document.getElementById('mdContent');
        const sheetTitle = document.getElementById('sheetTitle');
        const helpTrigger = document.getElementById('helpTrigger');
        const helpBox = document.getElementById('helpBox');

        document.getElementById('whatsNewRow').addEventListener('click', openSheet);
        document.getElementById('sheetCloseBtn').addEventListener('click', closeSheet);
        overlay.addEventListener('click', e => { if (e.target === overlay) closeSheet(); });

        helpTrigger.addEventListener('click', () => {
            helpTrigger.style.display = 'none';
            helpBox.style.display = 'block';
        });

        function openSheet() {
            overlay.classList.add('open');
            document.body.style.overflow = 'hidden';
            sheetTitle.textContent = `What's New in ${appTitle}`;
            mdContent.innerHTML = '<p class="md-loading">Loading…</p>';
            
            // Reset help state
            helpTrigger.style.display = 'inline-block';
            helpBox.style.display = 'none';
            
            fetchWhatsNew();
        }

        function closeSheet() {
            overlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        async function fetchWhatsNew() {
            try {
                const res = await fetch('https://mahi902.github.io/DocuWritePro/whatsnew.md');
                if (!res.ok) throw new Error('Not found');
                const text = await res.text();
                mdContent.innerHTML = renderMarkdown(text);
            } catch (e) {
                mdContent.innerHTML = '<p class="md-loading">Could not load release notes.</p>';
            }
        }
    </script>
</body>
</html>
