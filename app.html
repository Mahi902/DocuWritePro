<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocuWrite Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="manifest" href="/manifest.json">
    
    <script>
// --- SW INIT START ---
(function() {
  try {
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js")
        .then(() => console.log("SW registered"))
        .catch(err => console.error("SW failed:", err));
    }
  } catch (e) {
    console.error("SW script error:", e);
  }
})();
// --- SW INIT END ---
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            -webkit-tap-highlight-color: transparent;
        }
        .tool-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            height: 110px;
        }
        .tool-card:active {
            transform: scale(0.97);
            background-color: #f1f5f9;
        }
        .tool-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }
        .tool-icon {
            font-size: 32px;
            color: #3b82f6;
            margin-bottom: 8px;
        }
        .tool-name {
            font-size: 12px;
            font-weight: 500;
            line-height: 1.2;
            color: #475569;
        }
        /* Star Icon Styling */
        .star-icon {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 20px;
            color: #cbd5e1;
            transition: all 0.2s;
            z-index: 10; /* Ensure it sits above the card click area */
            padding: 4px; /* Increase click target area */
            border-radius: 50%;
        }
        .star-icon:hover {
            background-color: rgba(0,0,0,0.05);
            color: #94a3b8;
        }
        .star-icon.active {
            color: #fbbf24;
            font-variation-settings: 'FILL' 1;
            transform: scale(1.1);
        }
        
/* New style for offline/unvisited tools */
.tool-card.offline-unvisited {
    filter: grayscale(10%) brightness(95%) sepia(20%) hue-rotate(-10deg) saturate(200%);
    opacity: 0.7;
    position: relative;
    cursor: not-allowed;
    /* Ensure the card click area is not affected by z-index issues */
    z-index: 1; 
}

.tool-card.offline-unvisited::after {
    content: "Offline Lock";
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(255, 0, 0, 0.15); /* Subtle red overlay */
    color: #b91c1c;
    font-weight: 700;
    font-size: 10px;
    border-radius: 12px;
    opacity: 0; 
    transition: opacity 0.3s;
    pointer-events: none; /* Crucial: Allows click to pass through to the card itself */
    z-index: 10;
}

.tool-card.offline-unvisited:hover::after {
    opacity: 1; 
}

/* Base style for the popup */
#offline-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    display: none; /* Initially hidden */
    justify-content: center;
    align-items: center;
    z-index: 9999;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

#offline-popup-content {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    text-align: center;
    max-width: 300px;
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

#offline-popup.show #offline-popup-content {
    transform: scale(1);
}
        /* Banner Animation */
        #adBanner {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 500px;
            opacity: 1;
            overflow: hidden;
        }
        #adBanner.hidden-banner {
            max-height: 0;
            opacity: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            margin: 0 !important;
            border: none !important;
        }

        /* Hide scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col w-full bg-white text-slate-800">

    <!-- Main Content Wrapper -->
    <div class="flex-1 flex flex-col p-4 md:p-6 space-y-6 w-full">

        <!-- Top Header -->
        <div class="flex justify-between items-center py-1">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800 tracking-tight">DocuWrite <span class="text-blue-500">Pro</span></h1>
            <button class="p-2 rounded-full hover:bg-slate-100 transition-colors" onclick="location.reload()">
                <span class="material-symbols-outlined text-slate-500">refresh</span>
            </button>
        </div>
<div id="offline-popup">
    <div id="offline-popup-content">
        <h3 class="text-xl font-bold text-red-600 mb-3">ðŸ”’ Offline Tool</h3>
        <p class="text-slate-700">This tool is not available offline. Visit it when online once to download it for future offline use.</p>
        <button onclick="document.getElementById('offline-popup').classList.remove('show'); document.getElementById('offline-popup').style.display = 'none';" class="mt-4 bg-blue-500 text-white px-5 py-2 rounded-lg hover:bg-blue-600 transition-colors">
            Got It
        </button>
    </div>
</div>
        <!-- Ad Banner -->
        <div id="adBanner" class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 md:p-8 border border-blue-200 shadow-sm relative group cursor-pointer" onclick="window.location.href='https://mahi902.github.io/Aurora/pollinatedai.html'">
            <!-- Close Button -->
            <button onclick="dismissBanner(event)" class="absolute top-2 right-2 p-2 rounded-full bg-white/50 hover:bg-white text-blue-800 z-20 transition-all hover:shadow-sm">
                <span class="material-symbols-outlined text-lg font-bold">close</span>
            </button>

            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-blue-200 rounded-full opacity-50 blur-3xl"></div>
            <h2 class="text-xl md:text-2xl font-bold text-blue-900 mb-2 relative z-10">Try Pollinated AI</h2>
            <p class="text-base text-blue-700 leading-relaxed relative z-10 max-w-2xl">Try the new Pollinated AI. Generate text, images and webpages with the power of next-gen generative models.</p>
            <span class="material-symbols-outlined absolute bottom-6 right-6 text-blue-300 text-5xl group-hover:text-blue-400 transition-colors">auto_awesome</span>
        </div>

        <!-- Dynamic Main Buttons -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Row 1 -->
            <div id="row-1-container" class="w-full">
                <button onclick="transformRow1()" class="w-full bg-blue-600 text-white font-semibold py-5 rounded-xl shadow-lg shadow-blue-200 hover:bg-blue-700 active:scale-[0.99] transition-all flex items-center justify-center gap-2 h-20">
                    <span class="material-symbols-outlined text-3xl">add</span> 
                    <span class="text-lg">New Document</span>
                </button>
            </div>
            <!-- Row 2 -->
            <div id="row-2-container" class="flex w-full h-20 rounded-xl overflow-hidden shadow-md cursor-pointer">
                <div onclick="transformRow2('image')" class="w-1/2 bg-sky-100 hover:bg-sky-200 text-sky-700 flex items-center justify-center gap-2 transition-colors relative group">
                    <span class="material-symbols-outlined text-2xl">image</span> 
                    <span class="font-medium text-base">Image Editing</span>
                </div>
                <div onclick="transformRow2('code')" class="w-1/2 bg-slate-800 hover:bg-slate-700 text-slate-300 opacity-90 flex items-center justify-center gap-2 transition-colors">
                    <span class="material-symbols-outlined text-2xl">code</span>
                    <span class="font-medium text-base">Code Editing</span>
                </div>
            </div>
        </div>

        <!-- Secondary Banner -->
        <div class="pt-2">
            <div class="flex items-center gap-2 mb-4 px-1">
                <span class="material-symbols-outlined text-purple-500 text-2xl">auto_awesome</span>
                <h3 class="font-bold text-xl text-slate-700">AI Powered Tools</h3>
            </div>
            <div class="grid grid-cols-3 md:grid-cols-6 gap-4">
                <a href="https://mahi902.github.io/Aurora/pollinatedai.html" class="flex flex-col items-center justify-center p-4 bg-purple-50 rounded-xl border border-purple-100 hover:bg-purple-100 transition-colors text-center h-28">
                    <span class="material-symbols-outlined text-purple-600 mb-2 text-3xl">psychology</span>
                    <span class="text-sm font-semibold text-purple-800">Pollinated AI</span>
                </a>
                <a href="https://mahi902.github.io/DocuWritePro/image-generator.html" class="flex flex-col items-center justify-center p-4 bg-pink-50 rounded-xl border border-pink-100 hover:bg-pink-100 transition-colors text-center h-28">
                    <span class="material-symbols-outlined text-pink-600 mb-2 text-3xl">photo_library</span>
                    <span class="text-sm font-semibold text-pink-800">Image Gen</span>
                </a>
                <a href="https://mahi902.github.io/DocuWritePro/wawm.html" class="flex flex-col items-center justify-center p-4 bg-indigo-50 rounded-xl border border-indigo-100 hover:bg-indigo-100 transition-colors text-center h-28">
                    <span class="material-symbols-outlined text-indigo-600 mb-2 text-3xl">web</span>
                    <span class="text-sm font-semibold text-indigo-800">WebGen</span>
                </a>
            </div>
        </div>

        <!-- Tools Section -->
        <div class="pt-6" id="tools-section">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-5 gap-4">
                <h3 class="font-bold text-slate-800 text-xl px-1">Tools</h3>
                <div class="relative w-full md:w-96">
                    <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">search</span>
                    <input type="text" id="toolSearch" placeholder="Search tools..." class="w-full bg-slate-100 border-none rounded-xl py-3 pl-10 pr-4 text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all outline-none text-slate-700 placeholder-slate-400">
                </div>
            </div>

            <div class="tools-container grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-4" id="toolsContainer">
                <!-- NOTE: Added onclick="toggleStar(event, this)" to stars and preventDefault to card clicks via JS -->
                
                <!-- Document Editing Tools -->
                <div class="tool-card" data-tool-name="Editor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/document-writer.html')">
                    <span class="material-symbols-outlined tool-icon">edit</span><div class="tool-name">Editor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Document Viewer" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/viewer.html')">
                    <span class="material-symbols-outlined tool-icon">visibility</span><div class="tool-name">Document Viewer</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Word Finder" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/word-description-finder.html')">
                    <span class="material-symbols-outlined tool-icon">menu_book</span><div class="tool-name">Word Finder</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Translator" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/translator.html')">
                    <span class="material-symbols-outlined tool-icon">language</span><div class="tool-name">Translator</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Document Signer" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/document-signer.html')">
                    <span class="material-symbols-outlined tool-icon">draw</span><div class="tool-name">Document Signer</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Find & Replacer" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/findandreplacer.html')">
                    <span class="material-symbols-outlined tool-icon">find_replace</span><div class="tool-name">Find & Replacer</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Page Number Adder" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/page-number-adder.html')">
                    <span class="material-symbols-outlined tool-icon">format_list_numbered</span><div class="tool-name">Page Number Adder</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Reorder & Merge" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/rm.html')">
                    <span class="material-symbols-outlined tool-icon">layers</span><div class="tool-name">Reorder & Merge</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Chart Maker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/chart-maker.html')">
                    <span class="material-symbols-outlined tool-icon">bar_chart</span><div class="tool-name">Chart Maker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Graph Maker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/graphmaker.html')">
                    <span class="material-symbols-outlined tool-icon">query_stats</span><div class="tool-name">Graph Maker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Whiteboard" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/whiteboard.html')">
                    <span class="material-symbols-outlined tool-icon">ad</span><div class="tool-name">Whiteboard</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Mind Map Maker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/mmm.html')">
                    <span class="material-symbols-outlined tool-icon">graph_2</span><div class="tool-name">Mind Map Maker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Table Maker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/table-maker.html')">
                    <span class="material-symbols-outlined tool-icon">table_chart</span><div class="tool-name">Table Maker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Watermark Adder" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/watermarker.html')">
                    <span class="material-symbols-outlined tool-icon">filter_alt</span><div class="tool-name">Watermark Adder</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Email Writer" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/email-writer.html')">
                    <span class="material-symbols-outlined tool-icon">email</span><div class="tool-name">Email Writer</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Spell Checker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/spell-checker.html')">
                    <span class="material-symbols-outlined tool-icon">spellcheck</span><div class="tool-name">Spell Checker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="File Extractor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/file-extractor.html')">
                    <span class="material-symbols-outlined tool-icon">unarchive</span><div class="tool-name">File Extractor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="QR Maker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/qr-code-maker.html')">
                    <span class="material-symbols-outlined tool-icon">qr_code</span><div class="tool-name">QR Maker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="ID Card Maker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/id-card-maker.html')">
                    <span class="material-symbols-outlined tool-icon">badge</span><div class="tool-name">ID Card Maker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="File Zipper" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/file-zipper.html')">
                    <span class="material-symbols-outlined tool-icon">archive</span><div class="tool-name">File Zipper</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="PDF Converter" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/converters.html')">
                    <span class="material-symbols-outlined tool-icon">picture_as_pdf</span><div class="tool-name">PDF Converter</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="PDF Compressor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/pdfcompressor.html')">
                    <span class="material-symbols-outlined tool-icon">compress</span><div class="tool-name">PDF Compressor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Context Field" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/context-field.html')">
                    <span class="material-symbols-outlined tool-icon">summarize</span><div class="tool-name">Context Field</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Gift Card Maker" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/gift-card-maker.html')">
                    <span class="material-symbols-outlined tool-icon">card_giftcard</span><div class="tool-name">Gift Card Maker</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Share File" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/docudrop.html')">
                    <span class="material-symbols-outlined tool-icon">file_upload</span><div class="tool-name">Share File</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Text Extractor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/text-extractor.html')">
                    <span class="material-symbols-outlined tool-icon">document_scanner</span><div class="tool-name">Text Extractor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Keyboard Click Test" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/keyboard-click-test.html')">
                    <span class="material-symbols-outlined tool-icon">keyboard</span><div class="tool-name">Keyboard Click Test</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>

                <!-- Code Editing Tools -->
                <div class="tool-card" data-tool-name="Frontend IDE" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/frontend-ide.html')">
                    <span class="material-symbols-outlined tool-icon">developer_mode</span><div class="tool-name">Frontend IDE</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="HTML Editor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/code-playground.html')">
                    <span class="material-symbols-outlined tool-icon">code</span><div class="tool-name">HTML Editor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="HTML Writer" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/html.html')">
                    <span class="material-symbols-outlined tool-icon">html</span><div class="tool-name">HTML Writer</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Website Generator" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/wawm.html')">
                    <span class="material-symbols-outlined tool-icon">web</span><div class="tool-name">Website Generator</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Markdown Editor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/mdeditor.html')">
                    <span class="material-symbols-outlined tool-icon">markdown</span><div class="tool-name">Markdown Editor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Button Designer" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/button-designer.html')">
                    <span class="material-symbols-outlined tool-icon">smart_button</span><div class="tool-name">Button Designer</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="HTML Splitter" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/html-splitter.html')">
                    <span class="material-symbols-outlined tool-icon">integration_instructions</span><div class="tool-name">HTML Splitter</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="GoTo Code" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/goto-code.html')">
                    <span class="material-symbols-outlined tool-icon">merge</span><div class="tool-name">GoTo Code</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Code Snipper" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/code-snipper.html')">
                    <span class="material-symbols-outlined tool-icon">content_cut</span><div class="tool-name">Code Snipper</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>

                <!-- Image Editing Tools -->
                <div class="tool-card" data-tool-name="Image Editor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/image-editor.html')">
                    <span class="material-symbols-outlined tool-icon">collections</span><div class="tool-name">Image Editor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Attribution Editor" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/atbedt.html')">
                    <span class="material-symbols-outlined tool-icon">display_settings</span><div class="tool-name">Attribution Editor</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Image Generator" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/image-generator.html')">
                    <span class="material-symbols-outlined tool-icon">auto_awesome</span><div class="tool-name">Image Generator</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
                <div class="tool-card" data-tool-name="Drawing Board" onclick="handleToolClick('https://mahi902.github.io/DocuWritePro/draw.html')">
                    <span class="material-symbols-outlined tool-icon">brush</span><div class="tool-name">Drawing Board</div>
                    <span class="material-symbols-outlined star-icon" onclick="toggleStar(event, this)">star</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Local Storage Keys ---
        const STORAGE_KEY_STARS = 'docuwrite_starred_tools';
        const STORAGE_KEY_BANNER = 'docuwrite_banner_hidden_until';

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            checkBannerStatus();
            initializeStars();
        });

        // --- Banner Logic ---
        function checkBannerStatus() {
            const hiddenUntil = localStorage.getItem(STORAGE_KEY_BANNER);
            const banner = document.getElementById('adBanner');
            
            if (hiddenUntil && Date.now() < parseInt(hiddenUntil)) {
                // If hidden time hasn't passed yet, keep it hidden (no animation on load)
                banner.style.display = 'none';
            }
        }

        function dismissBanner(event) {
            event.stopPropagation(); // Prevent ad click
            const banner = document.getElementById('adBanner');
            
            // Animate Close
            banner.classList.add('hidden-banner');
            
            // Set timer for 5 minutes (5 * 60 * 1000 ms)
            const fiveMinutesFromNow = Date.now() + (5 * 60 * 1000);
            localStorage.setItem(STORAGE_KEY_BANNER, fiveMinutesFromNow.toString());
            
            // Remove from flow after animation
            setTimeout(() => {
                banner.style.display = 'none';
            }, 500);
        }

        // --- Starred Tools Logic ---
        function getStarredTools() {
            const stars = localStorage.getItem(STORAGE_KEY_STARS);
            return stars ? JSON.parse(stars) : [];
        }

        function initializeStars() {
            const starredTools = getStarredTools();
            const toolsContainer = document.getElementById('toolsContainer');
            const allTools = Array.from(toolsContainer.children);

            // Update visual state
            allTools.forEach(card => {
                const toolName = card.getAttribute('data-tool-name');
                const starIcon = card.querySelector('.star-icon');
                if (starredTools.includes(toolName)) {
                    starIcon.classList.add('active');
                }
            });

            sortTools();
        }

        function toggleStar(event, element) {
            event.stopPropagation(); // CRITICAL: Prevents triggering the tool card click
            
            const card = element.closest('.tool-card');
            const toolName = card.getAttribute('data-tool-name');
            let starredTools = getStarredTools();

            // Toggle state
            if (starredTools.includes(toolName)) {
                starredTools = starredTools.filter(name => name !== toolName);
                element.classList.remove('active');
            } else {
                starredTools.push(toolName);
                element.classList.add('active');
            }

            // Save
            localStorage.setItem(STORAGE_KEY_STARS, JSON.stringify(starredTools));

            // Re-sort
            sortTools();
        }

        function sortTools() {
            const toolsContainer = document.getElementById('toolsContainer');
            const allTools = Array.from(toolsContainer.children);
            const starredTools = getStarredTools();

            // Separate starred and unstarred
            const starredElements = [];
            const unstarredElements = [];

            allTools.forEach(card => {
                const toolName = card.getAttribute('data-tool-name');
                if (starredTools.includes(toolName)) {
                    starredElements.push(card);
                } else {
                    unstarredElements.push(card);
                }
            });

            // Clear container
            toolsContainer.innerHTML = '';

            // Re-append in order: Starred first, then unstarred
            // (Preserve internal relative order for both groups)
            starredElements.forEach(card => toolsContainer.appendChild(card));
            unstarredElements.forEach(card => toolsContainer.appendChild(card));
        }

        // --- Navigation Handler ---
        function handleToolClick(url) {
            window.location.href = url;
        }

        // --- Existing Button Logic ---
        const row1Container = document.getElementById('row-1-container');
        const row2Container = document.getElementById('row-2-container');

        function transformRow1() {
            row1Container.innerHTML = `
                <div class="flex gap-4 w-full animate-fade-in h-20">
                    <a href="https://mahi902.github.io/DocuWritePro/document-writer.html" class="flex-1 bg-blue-50 border border-blue-200 text-blue-700 font-medium py-4 rounded-xl shadow-sm hover:bg-blue-100 transition-colors flex flex-col items-center justify-center gap-1">
                        <span class="material-symbols-outlined text-2xl">edit_document</span>
                        <span class="text-base">Default Editor</span>
                    </a>
                    <a href="https://mahi902.github.io/DocuWritePro/collab-document-editor.html" class="flex-1 bg-blue-50 border border-blue-200 text-blue-700 font-medium py-4 rounded-xl shadow-sm hover:bg-blue-100 transition-colors flex flex-col items-center justify-center gap-1">
                        <span class="material-symbols-outlined text-2xl">group</span>
                        <span class="text-base">Collab Editor</span>
                    </a>
                </div>
            `;
        }

        function transformRow2(type) {
            if (type === 'image') {
                row2Container.outerHTML = `
                    <div id="row-2-container" class="flex gap-4 w-full animate-fade-in h-20">
                        <a href="https://mahi902.github.io/DocuWritePro/image-editor.html" class="flex-1 bg-sky-50 border border-sky-200 text-sky-700 font-medium py-4 rounded-xl shadow-sm hover:bg-sky-100 transition-colors flex flex-col items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-2xl">photo_size_select_large</span>
                            <span class="text-base">Image Editor</span>
                        </a>
                        <a href="https://mahi902.github.io/DocuWritePro/atbedt.html" class="flex-1 bg-sky-50 border border-sky-200 text-sky-700 font-medium py-4 rounded-xl shadow-sm hover:bg-sky-100 transition-colors flex flex-col items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-2xl">attribution</span>
                            <span class="text-base">Attribution</span>
                        </a>
                    </div>
                `;
            } else if (type === 'code') {
                row2Container.outerHTML = `
                    <div id="row-2-container" class="flex gap-2 w-full animate-fade-in h-20">
                        <a href="https://mahi902.github.io/DocuWritePro/code-playground.html" class="flex-1 bg-slate-800 text-slate-200 font-medium rounded-xl shadow-sm hover:bg-slate-700 transition-colors flex flex-col items-center justify-center gap-1 text-center p-1">
                            <span class="material-symbols-outlined text-xl">code</span>
                            <span class="text-xs">HTML Editor</span>
                        </a>
                        <a href="https://mahi902.github.io/DocuWritePro/html.html" class="flex-1 bg-slate-800 text-slate-200 font-medium rounded-xl shadow-sm hover:bg-slate-700 transition-colors flex flex-col items-center justify-center gap-1 text-center p-1">
                            <span class="material-symbols-outlined text-xl">smart_toy</span>
                            <span class="text-xs">HTML AI</span>
                        </a>
                        <a href="https://mahi902.github.io/DocuWritePro/frontend-ide.html" class="flex-1 bg-slate-800 text-slate-200 font-medium rounded-xl shadow-sm hover:bg-slate-700 transition-colors flex flex-col items-center justify-center gap-1 text-center p-1">
                            <span class="material-symbols-outlined text-xl">terminal</span>
                            <span class="text-xs">Frontend IDE</span>
                        </a>
                    </div>
                `;
            }
        }

        const searchInput = document.getElementById('toolSearch');
        const toolsCont = document.getElementById('toolsContainer');
        
        searchInput.addEventListener('keyup', (e) => {
            const term = e.target.value.toLowerCase();
            const cards = toolsCont.querySelectorAll('.tool-card'); // Get dynamic list
            
            cards.forEach(card => {
                const toolName = card.getAttribute('data-tool-name').toLowerCase();
                if (toolName.includes(term)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    </script>

    <style>
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
<style>
    /* BASE RESET FOR THIS COMPONENT ONLY */
    #docuwrite-about-wrapper * {
        box-sizing: border-box; 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        color: #333; 
        line-height: 1.5;
        margin: 0;
        padding: 0;
    }

    /* --- Invisible Trigger Area Styles --- */
    #settings-icon { 
        position: fixed;
        bottom: 1px;
        right: 1px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: transparent; 
        border: none;
        box-shadow: none;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        cursor: pointer;
        z-index: 10000; 
        transition: none; 
        display: flex; 
    }

    /* Ensure no visual content is inside the button */
    #settings-icon::after {
        content: "";
        width: 100%;
        height: 100%;
    }

    /* --- Popup Overlay and Content Styles --- */
    #about-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex; 
        justify-content: center;
        align-items: center;
        z-index: 20000; 
        background-color: rgba(0, 0, 0, 0.1); 
        backdrop-filter: blur(15px); 
        -webkit-backdrop-filter: blur(15px);
        opacity: 0;
        pointer-events: none; 
        transition: opacity 0.3s ease-in-out;
    }

    #about-popup.open {
        opacity: 1;
        pointer-events: auto; 
    }

    /* --- Popup Content Box Styles (Pop Animation) --- */
    #popup-content {
        background-color: #ffffff; 
        border-radius: 12px; 
        padding: 30px 40px; 
        width: 90%; 
        max-width: 800px; 
        height: 90%;
        max-height: 700px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); 
        overflow-y: auto; 
        position: relative;
        
        transform: scale(0.8); 
        opacity: 0;
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                         opacity 0.3s ease-in-out;
    }

    #about-popup.open #popup-content {
        transform: scale(1); 
        opacity: 1;
    }

    /* --- Content Styling (Scoped via #popup-content descendents) --- */
    #popup-content #close-btn { 
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 28px; 
        cursor: pointer;
        background: none;
        border: none;
        color: #666; 
        transition: color 0.2s ease;
        padding: 5px; 
        line-height: 1; 
    }

    #popup-content h2 { 
        font-size: 28px;
        margin-bottom: 8px;
        color: #222; 
        font-weight: 600; 
    }
    
    #popup-content h3 { 
        font-size: 22px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 8px;
        margin-top: 30px; 
        margin-bottom: 20px;
        color: #222;
        font-weight: 600;
    }

    #popup-content p {
        font-size: 16px;
        margin-bottom: 20px;
    }

    #popup-content .blue-text {
        color: #007bff; 
        font-weight: 700;
    }

    #popup-content .app-version {
        font-size: 15px;
        color: #777;
        margin-bottom: 25px; 
        border-bottom: 1px solid #eee; 
        padding-bottom: 15px;
    }

    #popup-content #release-logs {
        list-style: none;
        padding: 0;
        max-height: 280px; 
        overflow-y: auto;
        border: 1px solid #eee; 
        border-radius: 8px;
        padding: 10px 15px;
        margin-bottom: 30px;
        background-color: #f9f9f9;
    }

    #popup-content #release-logs li {
        padding: 12px 0;
        border-bottom: 1px solid #e0e0e0; 
        font-size: 15px;
    }
    
    #popup-content #release-logs li:last-child {
        border-bottom: none; 
    }

    #popup-content .release-title {
        font-weight: 600;
        color: #333;
    }
    
    #popup-content .release-date {
        font-size: 13px;
        color: #888;
        margin-left: 10px;
    }
    
    #popup-content .release-link {
        display: inline-block; 
        color: #007bff;
        text-decoration: none;
        margin-top: 5px;
        font-size: 14px;
    }

    #popup-content #legal-iframe {
        width: 100%;
        height: 350px; 
        border: 1px solid #ddd;
        border-radius: 8px; 
        background-color: #fff; 
    }

</style>

<div id="docuwrite-about-wrapper"> 

    <div id="settings-icon" role="button" aria-label="Open Settings and About">
    </div>

    <div id="about-popup">
        <div id="popup-content">
            <button id="close-btn">&times;</button>

            <h2>About <span class="blue-text">DocuWrite</span> <span class="blue-text">Pro</span></h2>
            <div class="app-version">App Version: <strong>4.9.7</strong></div>
            <p>
                The official DocuWrite Pro mobile, tablet and desktop app! Edit documents, images and code. Use the latest features with the help of AI! The <strong>all-in-one premium document editing suite</strong>.
            </p>

            <h3>Release Logs</h3>
            <ul id="release-logs">
                <li id="loading-message">Loading release logs...</li>
            </ul>

            <h3>Legal Documents</h3>
            <iframe id="legal-iframe" src="https://mahi902.github.io/DocuWritePro/legal-documents.html" title="Legal Documents"></iframe>

        </div>
    </div>

</div>

<script>
    const settingsIcon = document.getElementById('settings-icon'); 
    const aboutPopup = document.getElementById('about-popup');
    const closeBtn = document.getElementById('close-btn');
    const releaseLogsList = document.getElementById('release-logs');
    const loadingMessage = document.getElementById('loading-message');
    
    // ðŸ”¥ NEW STATE VARIABLE: Controls whether the popup can be closed
    let isClosable = true;

    // --- Popup Logic ---
    function openPopup() {
        aboutPopup.classList.add('open');
        settingsIcon.style.display = 'none';
        if (document.body) {
            document.body.style.overflow = 'hidden'; 
        }
        
        // ðŸ”¥ LOCK LOGIC: Set closable state to false upon opening
        isClosable = false;
        
        // ðŸ”¥ UNLOCK LOGIC: Allow closing after 2 seconds
        setTimeout(() => {
            isClosable = true;
        }, 2000); // 2000 milliseconds = 2 seconds
    }

    // â­ PROTECTED: Requires isClosable = true (used for backdrop click)
    function closePopup() {
        // ðŸ”¥ CHECK: Only allow closing if isClosable is true
        if (!isClosable) {
            console.log("Closing prevented: Must wait 2 seconds.");
            return;
        }
        
        closePopupUnprotected();
    }
    
    // â­ UNPROTECTED: Closes immediately (used for the 'X' close button)
    function closePopupUnprotected() {
        aboutPopup.classList.remove('open'); 
        
        setTimeout(() => {
            settingsIcon.style.display = 'flex';
            if (document.body) {
                document.body.style.overflow = ''; 
            }
        }, 300); 
    }

    settingsIcon.addEventListener('click', (e) => {
        e.stopPropagation(); 
        openPopup();
    }); 
    
    // âœ… MODIFIED: Close Button uses the UNPROTECTED function (the 'X' is free)
    closeBtn.addEventListener('click', closePopupUnprotected);
    
    // âœ… Backdrop Click still uses the PROTECTED function
    aboutPopup.addEventListener('click', (e) => {
        if (e.target === aboutPopup) {
            closePopup(); // This calls the function with the 2-second check
        }
    });

    // --- Fetch GitHub Releases (Unchanged) ---
    async function fetchReleases() {
        const apiUrl = `https://api.github.com/repos/mahi902/DocuWritePro/releases`;

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) {
                throw new Error(`GitHub API status: ${response.status}`);
            }
            const releases = await response.json();

            if (loadingMessage) loadingMessage.remove();

            if (releases.length === 0) {
                releaseLogsList.innerHTML = '<li style="text-align: center;">No releases found.</li>';
                return;
            }

            releases.forEach(release => {
                const releaseItem = document.createElement('li');
                const publishedDate = release.published_at ? 
                    new Date(release.published_at).toLocaleDateString(undefined, {
                        year: 'numeric', month: 'long', day: 'numeric'
                    }) : 'N/A';

                releaseItem.innerHTML = `
                    <span class="release-title">${release.name || release.tag_name}</span>
                    <span class="release-date">(${publishedDate})</span>
                    <a href="${release.html_url}" target="_blank" class="release-link">View Release Notes</a>
                `;

                releaseLogsList.appendChild(releaseItem);
            });

        } catch (error) {
            console.error('Failed to fetch release logs:', error);
            if (loadingMessage) loadingMessage.remove();
            releaseLogsList.innerHTML = `<li id="error-message">Error loading releases. Please check your network connection or the console for details.</li>`;
        }
    }

    document.addEventListener('DOMContentLoaded', fetchReleases);
</script>

<style>
  /* Slide animations */
  @keyframes slideIn {
    0% { opacity: 0; transform: translateX(35px); }
    100% { opacity: 1; transform: translateX(0); }
  }
  @keyframes slideOut {
    0% { opacity: 1; transform: translateX(0); }
    100% { opacity: 0; transform: translateX(-35px); }
  }

  #onboardOverlay {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #006eff, #0094ff);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    font-family: Arial, sans-serif;
    z-index: 999999;
    padding: 40px;
    animation: slideIn 0.45s ease forwards;
    text-align: justify;
  }

  #onboardOverlay h1 {
    font-size: 2rem;
    margin: 0;
    text-align: center;
    width: 80%;
    animation: slideIn 0.45s ease forwards;
  }

  #onboardOverlay p {
    margin-top: 15px;
    font-size: 1.15rem;
    opacity: 0.95;
    width: 80%;
    line-height: 1.55;
    animation: slideIn 0.45s ease forwards;
  }

  /* Next button */
  #onboardNextBtn {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(8px);
    color: #0060d6;
    padding: 12px 22px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    border: none;
    z-index: 1000000;
    box-shadow: 0 4px 18px rgba(0,0,0,0.15);
    transition: 0.25s ease;
  }
  #onboardNextBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 22px rgba(0,0,0,0.2);
  }

  /* Bottom-right highlight */
  #highlightBox {
    position: fixed;
    width: 0;
    height: 0;
    bottom: 0;
    right: 0;
    background: transparent;
    border-radius: 8px;
    transition: background 0.4s ease;
    z-index: 1000001;
  }
</style>

<div id="onboardOverlay" style="display:none;">
  <h1 id="onboardTitle">Welcome to DocuWrite Pro</h1>
  <p id="onboardSubtitle">Your very own Premium Document Editing Suite.</p>
</div>

<div id="highlightBox"></div>
<button id="onboardNextBtn" style="display:none;">Next</button>

<script>
  if (!localStorage.getItem("dwpOnboardDone")) {
    const overlay = document.getElementById("onboardOverlay");
    const title = document.getElementById("onboardTitle");
    const subtitle = document.getElementById("onboardSubtitle");
    const nextBtn = document.getElementById("onboardNextBtn");
    const highlight = document.getElementById("highlightBox");

    overlay.style.display = "flex";
    nextBtn.style.display = "block";

    let step = 1;

    function animateChange() {
      title.style.animation = "slideOut 0.3s ease forwards";
      subtitle.style.animation = "slideOut 0.3s ease forwards";

      setTimeout(() => {
        title.style.animation = "slideIn 0.45s ease forwards";
        subtitle.style.animation = "slideIn 0.45s ease forwards";
      }, 300);
    }

    nextBtn.onclick = () => {
      animateChange();

      switch (step) {

        case 1:
          title.textContent = "Disclaimer";
          subtitle.textContent = "By continuing you acknowledge you have read all the information before and will read all the information after, provided in this set of slides.";
          step++;
          break;

        case 2:
          title.style.display = "none";
          subtitle.textContent =
            "This is the official DocuWrite Pro mobile and desktop app. Edit documents, images and code. Use the latest features with the help of AI!";
          step++;
          break;

        case 3:
          subtitle.textContent =
            "All the icons, symbols and text fonts used in this app are provided by Google Fonts. The project is not affiliated or managed by Google. All the AI related services in this app are provided by pollinations.ai. This project is not affiliated with any AI model or industry.";
          step++;
          break;

        case 4:
          subtitle.textContent =
            "This app is purely hosted on GitHub Pages. The creator and manager of this app is github.com/Mahi902. Official project homepage at mahi902.github.io";
          step++;
          break;

        case 5:
          highlight.style.background = "white";
          subtitle.innerHTML =
            `This app is built on HTML, CSS & JS. It is a PWA. To open app settings, double click the bottom-right corner. 
             Auto updates are supported. Click the update icon on top-right. Data is saved using cookies; clearing cookies may remove data. 
             Offline tools work only after being opened online once. Updates may arrive slightly later than web version. 
             By using DocuWrite Pro mobile app, you agree to our 
             <a href="https://mahi902.github.io/DocuWritePro/legal-documents.html" target="_blank" style="color:white; text-decoration:underline;">Legal Documentation</a>.`;
          nextBtn.textContent = "Finish & Launch Dashboard";
          step++;
          break;

        case 6:
          localStorage.setItem("dwpOnboardDone", "true");

          overlay.style.animation = "slideOut 0.35s ease forwards";

          setTimeout(() => {
            overlay.remove();
            nextBtn.remove();
            highlight.remove();
          }, 350);
          break;
      }
    };
  }
</script>
    
<script>
// =========================================================================
// OFFLINE VISITED CHECK & OVERRIDE LOGIC
// =========================================================================

const STORAGE_KEY_VISITED_TOOLS = 'docuwrite_visited_tools_v2'; // New key to prevent conflicts

// --- Tool State Management ---

function getVisitedTools() {
    const visited = localStorage.getItem(STORAGE_KEY_VISITED_TOOLS);
    return visited ? JSON.parse(visited) : [];
}

function markToolAsVisited(toolName) {
    let visitedTools = getVisitedTools();
    if (!visitedTools.includes(toolName)) {
        visitedTools.push(toolName);
        localStorage.setItem(STORAGE_KEY_VISITED_TOOLS, JSON.stringify(visitedTools));
        // Remove the tint immediately after marking as visited
        const card = document.querySelector(`.tool-card[data-tool-name="${toolName}"]`);
        if (card) {
            card.classList.remove('offline-unvisited');
        }
    }
}

// --- Visual Tining Logic ---

function applyOfflineTint() {
    // Only apply the tint if the device is currently offline
    if (navigator.onLine) {
        document.querySelectorAll('.tool-card').forEach(card => {
            card.classList.remove('offline-unvisited');
        });
        return;
    }

    const visitedTools = getVisitedTools();
    const allTools = document.querySelectorAll('.tool-card');

    allTools.forEach(card => {
        const toolName = card.getAttribute('data-tool-name');
        if (!visitedTools.includes(toolName)) {
            card.classList.add('offline-unvisited');
        } else {
            card.classList.remove('offline-unvisited');
        }
    });
}

function showOfflinePopup() {
    const popup = document.getElementById('offline-popup');
    if (popup) {
        popup.style.display = 'flex';
        // Use a short delay to trigger the transition/scale-in effect (if CSS is applied)
        setTimeout(() => popup.classList.add('show'), 10); 
    }
}

// --- Event Delegation Override ---

function attachOfflineProtection() {
    const toolsContainer = document.getElementById('toolsContainer');
    if (!toolsContainer) return;

    // Attach the main click listener to the container (Event Delegation)
    toolsContainer.addEventListener('click', (event) => {
        const card = event.target.closest('.tool-card');
        
        // 1. Basic checks
        if (!card) return;
        
        const toolName = card.getAttribute('data-tool-name');
        if (!toolName) return; // Must have a name to track state

        const isOffline = !navigator.onLine;
        const isVisited = getVisitedTools().includes(toolName);

        if (isOffline && !isVisited) {
            // 2. Case: Offline AND unvisited -> BLOCK navigation
            event.stopPropagation(); // Stop the click event from propagating up (e.g., to the body)
            event.preventDefault();  // Although not strictly needed since it's a <div>, it's good practice
            
            // Override the existing onclick handler by replacing it temporarily
            // This is the tricky part since we cannot remove the original handler easily.
            // However, by stopping propagation and preventing default, we rely on the
            // original handleToolClick to *not* run if we successfully override the flow.
            
            showOfflinePopup();
            return;
        }

        // 3. Case: Online OR Offline AND visited -> ALLOW navigation

        // The card is about to be clicked, which means navigation will happen (via existing onclick).
        // Mark it as visited BEFORE the navigation occurs.
        markToolAsVisited(toolName);
        
        // Allow the existing 'onclick' handler on the card to fire normally.
        // Since we are NOT calling 'handleToolClick' directly, the existing HTML MUST be left intact.
    });
}

// --- Initialization Updates ---

// Hook the logic into the DOMContentLoaded event
document.addEventListener('DOMContentLoaded', () => {
    // ... (Keep existing DOMContentLoaded logic: checkBannerStatus(), initializeStars())
    
    // NEW: Apply visual state on initial load
    applyOfflineTint(); 
    
    // NEW: Set up the click override
    attachOfflineProtection();
});

// NEW: Add listeners for online/offline events for live tint update
window.addEventListener('online', applyOfflineTint);
window.addEventListener('offline', applyOfflineTint);

// =========================================================================
// END OF OFFLINE VISITED CHECK & OVERRIDE LOGIC
// =========================================================================
</script>
<script>
document.addEventListener('click', e => { const card = e.target.closest('.tool-card'); if (card && card.classList.contains('offline-unvisited')) { e.stopImmediatePropagation(); showOfflinePopup(); } else if (card) { const toolName = card.getAttribute('data-tool-name'); if (toolName) markToolAsVisited(toolName); } }, true);</script>
    <!-- Drop-in fullscreen hotspot -->
<div id="fullscreenHotspot"></div>

<style>
  #fullscreenHotspot {
    position: fixed;
    top: 0;
    left: 0;
    width: 20px;
    height: 20px;
    cursor: pointer;
    z-index: 9999;
    /* optional: for visibility */
    background: rgba(0,0,0,0.0);
  }
</style>

<script>
  const hotspot = document.getElementById('fullscreenHotspot');

  hotspot.addEventListener('dblclick', () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(err => {
        console.error(`Error attempting to enable fullscreen: ${err.message}`);
      });
    } else {
      document.exitFullscreen();
    }
  });
</script>
    
</body>
</html>
