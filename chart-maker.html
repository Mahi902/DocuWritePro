<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Maker - Google Docs Style</title>
    <meta name="description" content="DocuWrite Pro is an all-in-one online workspace that lets you write, edit, convert, design, and manage documents and digital content instantly—no installation, no complexity.">
  <meta name="keywords" content="DocuWrite Pro, Mohtadi Azad Mahi, AI writer, document editor, online text tool, GitHub project, DocuWritePro, Document Editor, Document, Editor, PDF, JPG, Edit, Text, Change File Type, File Changer, Format, Format Changer, Office, Docs, A4, Editor, General document editing, Collab, Editing documents together, Document Viewer, Viewing documents, Word Finder, Searching for specific words, Translator, Language translation, Document Signer, Electronically signing documents, Page Number Adder, Adding page numbers to documents, Chart Maker, Creating data charts, Table Maker, Creating tables, Watermark Adder, Adding watermarks to files, Email Writer, Assisting with writing emails, Spell Checker, Checking spelling and grammar, File Extractor, Extracting contents from files, QR Maker, Creating QR codes, ID Card Maker, Designing and creating ID cards, File Zipper, Compressing or zipping files, PDF Converter, Converting files to or from PDF format, Context Field, Analyzing text (e.g., word count, frequency), Gift Card Maker, Creating custom gift cards, Share File, Uploading or sharing a file, Text Extractor, Extracting text from sources (e.g., images), Keyboard Click Test, Testing keyboard functionality, Frontend IDE, Integrated Development Environment for frontend coding, HTML Editor, Editing HTML code, HTML Writer, Writing or generating HTML content, Button Designer, Designing user interface buttons, HTML Splitter, Splitting HTML files or elements, GoTo Code, Navigation feature in an IDE/editor, Code Snipper, Storing or managing code snippets, Image Editor, Editing images, Image Generator, Generating new images, Drawing Board, A simple drawing or sketching tool, HTML, CSS, JS, Online, Fast, Easy, No login, No signup, Free, No credit card required, Mohtadi, Azad, Mahi, Mohtadi Azad, Mohtadi Azad Mahi, mahi902">
  <meta name="author" content="Mohtadi Azad Mahi">
  <meta name="robots" content="index, follow">

  <!-- Favicon & App Icons -->
  <link rel="icon" type="image/png" sizes="16x16" href="https://i.ibb.co.com/k2QvnvMz/IMG-20251010-111934.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co.com/k2QvnvMz/IMG-20251010-111934.jpg">
  <link rel="icon" type="image/png" sizes="192x192" href="https://i.ibb.co.com/k2QvnvMz/IMG-20251010-111934.jpg">
  <link rel="apple-touch-icon" href="https://i.ibb.co.com/k2QvnvMz/IMG-20251010-111934.jpg">
  <meta name="theme-color" content="#ffffff">

  <!-- App & Brand Metadata -->
  <meta property="og:site_name" content="DocuWrite Pro">
  <meta name="application-name" content="DocuWrite Pro">
  <meta name="apple-mobile-web-app-title" content="DocuWrite Pro">

  <!-- Open Graph -->
  <meta property="og:title" content="DocuWrite Pro — Online Document Editor">
  <meta property="og:description" content="Edit, format, and export documents easily with DocuWrite Pro by Mohtadi Azad Mahi.">
  <meta property="og:url" content="https://mahi902.github.io/DocuWritePro/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://i.ibb.co.com/k2QvnvMz/IMG-20251010-111934.jpg">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="DocuWrite Pro — Online Document Editor">
  <meta name="twitter:description" content="Create, format, and export documents easily with DocuWrite Pro. Built by Mohtadi Azad Mahi.">
  <meta name="twitter:image" content="https://i.ibb.co.com/k2QvnvMz/IMG-20251010-111934.jpg">

  <!-- Structured Data (Google Knowledge Graph) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "DocuWrite Pro",
    "alternateName": "DocuWrite Pro — Online Document Editor",
    "url": "https://mahi902.github.io/DocuWritePro/",
    "creator": {
      "@type": "Person",
      "name": "Mohtadi Azad Mahi"
    }
  }
  </script>
    <!-- Icons and Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        /* General Body and Layout Styles */
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #202124;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Header Styles */
        .header {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            border-bottom: 1px solid #e0e0e0;
            background-color: white;
            flex-shrink: 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-right: 30px;
        }

        .logo-icon {
            color: #4285F4;
            font-size: 24px;
            margin-right: 8px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 500;
            color: #5f6368;
        }

        /* Toolbar for Chart Selection */
        .toolbar {
            display: flex;
            padding: 8px 16px;
            background-color: white;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .toolbar-group {
            display: flex;
            margin-right: 16px;
            border-right: 1px solid #e0e0e0;
            padding-right: 16px;
        }
        .toolbar-group:last-child {
            border-right: none;
        }

        .tool-button {
            background: none;
            border: none;
            border-radius: 4px;
            padding: 8px;
            margin: 0 2px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #5f6368;
            font-size: 12px;
            min-width: 60px;
            transition: background-color 0.2s, color 0.2s;
        }

        .tool-button:hover {
            background-color: #f1f3f4;
        }

        .tool-button.active {
            background-color: #e8f0fe;
            color: #1967d2;
            box-shadow: 0 1px 2px rgba(66, 133, 244, 0.2);
        }

        .tool-button .material-icons {
            font-size: 20px;
            margin-bottom: 2px;
        }

        /* Main Content Area */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar for Settings */
        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #e0e0e0;
            padding: 16px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 500;
            color: #5f6368;
            margin-bottom: 12px;
            padding-bottom: 4px;
            border-bottom: 1px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            color: #5f6368;
            margin-bottom: 6px;
        }

        .form-input, .form-input[type="color"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input[type="color"] {
            padding: 4px;
            height: 38px;
        }

        .form-input:focus {
            outline: none;
            border-color: #4285F4;
            box-shadow: 0 0 0 2px #e8f0fe;
        }
        .form-input:disabled {
            background-color: #f1f3f4;
            cursor: not-allowed;
        }

        /* Chart Display Area */
        .chart-container {
            flex: 1;
            padding: 24px;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .chart-wrapper {
            width: 95%; /* Increased width for better use of space */
            max-width: 1000px; /* Increased max width */
            background-color: white;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 3px 6px rgba(60,64,67,0.15); /* More pronounced shadow */
            position: relative;
        }
        /* Enforce Aspect Ratio for Chart Canvas */
        .chart-canvas-wrapper {
            position: relative;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio (56.25% of width) */
            margin-bottom: 24px;
        }
        #chartCanvas {
            position: absolute;
            width: 100%;
            height: 100%;
            display: block;
        }

        .chart-title {
            font-size: 22px;
            font-weight: 500;
            margin-bottom: 16px;
            text-align: center;
        }

        /* Data Table Styles */
        .data-table-container {
            margin-top: 24px;
            max-height: 250px;
            overflow: auto;
            border: 1px solid #dadce0;
            border-radius: 4px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            border: 1px solid #dadce0;
            padding: 0; /* Padding handled by input */
            text-align: center;
            font-size: 13px;
        }

        .data-table th {
            background-color: #f1f3f4;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 8px;
        }

        .data-table input {
            width: 100%;
            border: none;
            text-align: center;
            font-family: inherit;
            background-color: transparent;
            padding: 8px 4px;
            box-sizing: border-box;
        }

        .data-table input:focus {
            outline: none;
            background-color: #e8f0fe;
        }

        /* Action Buttons */
        .action-buttons {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
        }

        .action-btn {
            background-color: #f1f3f4;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            color: #3c4043;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }

        .action-btn:hover {
            background-color: #e8eaed;
        }

        .download-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 20;
        }

        .download-btn .material-icons {
            font-size: 16px;
            margin-right: 4px;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <div class="logo">
            <span class="material-icons logo-icon">insert_chart</span>
            <span class="logo-text">Chart Maker</span>
        </div>
    </div>

    <!-- Toolbar for Selecting Chart Type -->
    <div class="toolbar">
        <div class="toolbar-group">
            <button class="tool-button active" data-chart-type="bar"><span class="material-icons">bar_chart</span>Bar</button>
            <button class="tool-button" data-chart-type="line"><span class="material-icons">show_chart</span>Line</button>
            <button class="tool-button" data-chart-type="pie"><span class="material-icons">pie_chart</span>Pie</button>
            <button class="tool-button" data-chart-type="doughnut"><span class="material-icons">donut_large</span>Doughnut</button>
        </div>
        <div class="toolbar-group">
            <button class="tool-button" data-chart-type="radar"><span class="material-icons">radar</span>Radar</button>
            <button class="tool-button" data-chart-type="polarArea"><span class="material-icons">track_changes</span>Polar</button>
            <button class="tool-button" data-chart-type="scatter"><span class="material-icons">scatter_plot</span>Scatter</button>
            <button class="tool-button" data-chart-type="bubble"><span class="material-icons">bubble_chart</span>Bubble</button>
        </div>
    </div>

    <!-- Main Content: Sidebar + Chart Area -->
    <div class="main-content">
        <div class="sidebar">
            <!-- Chart Settings -->
            <div class="sidebar-section">
                <div class="sidebar-title">Chart Settings</div>
                <div class="form-group">
                    <label class="form-label">Chart Title</label>
                    <input type="text" class="form-input" id="chartTitle" value="Sales Data Analysis">
                </div>
            </div>

            <!-- Data Structure Settings -->
            <div class="sidebar-section">
                <div class="sidebar-title">Data Structure</div>
                <div class="form-group">
                    <label class="form-label">Number of Data Series</label>
                    <input type="number" class="form-input" id="seriesCount" min="1" max="10" value="3">
                </div>
                <div class="form-group">
                    <label class="form-label">Number of Labels / Points</label>
                    <input type="number" class="form-input" id="labelCount" min="1" max="20" value="4">
                </div>
                <button id="updateDataBtn" class="action-btn" style="width: 100%;">
                    <span class="material-icons" style="font-size: 16px; margin-right: 4px;">refresh</span>
                    Regenerate Table & Chart
                </button>
            </div>

            <!-- Color Customization -->
            <div class="sidebar-section">
                <div class="sidebar-title">Series / Point Colors</div>
                <div id="colorPalette">
                    <!-- Color inputs will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-wrapper">
                <button id="downloadBtn" class="action-btn download-btn">
                    <span class="material-icons">download</span>
                    Download PNG
                </button>
                <div class="chart-title" id="displayChartTitle">Sales Data Analysis</div>
                
                <div class="chart-canvas-wrapper">
                    <canvas id="chartCanvas"></canvas>
                </div>
                
                <div class="data-table-container">
                    <table class="data-table" id="dataTable">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="action-buttons">
                    <button id="addRowBtn" class="action-btn">+ Add Row</button>
                    <!-- I've removed the redundant button from the original, as the table structure defines the data -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES & INITIAL STATE ---
        const defaultColors = [
            '#4285F4', '#34A853', '#FBBC05', '#EA4335', '#673AB7',
            '#00BCD4', '#FF9800', '#795548', '#9E9E9E', '#607D8B'
        ];
        // The default colors for Pie/Doughnut labels
        const pieDoughnutColors = ['#4285F4', '#34A853', '#FBBC05', '#EA4335', '#673AB7', '#00BCD4', '#FF9800', '#795548', '#9E9E9E', '#607D8B', '#FF5722', '#009688', '#FFEB3B'];

        let chart = null;
        let currentChartType = 'bar';
        const seriesCountInput = document.getElementById('seriesCount');
        const labelCountInput = document.getElementById('labelCount');

        // Chart types that are "coordinate" based (require X/Y axes)
        const coordinateCharts = ['bar', 'line', 'scatter', 'bubble'];
        // Chart types that are "segment" based (Pie, Doughnut, Polar)
        const segmentCharts = ['pie', 'doughnut', 'polarArea'];

        // --- CHART CREATION AND DATA HANDLING ---

        /**
         * Parses the data from the HTML table and formats it for Chart.js
         * based on the current chart type.
         * @returns {object} The data object for Chart.js.
         */
        function getChartData() {
            const table = document.getElementById('dataTable');
            const rows = table.querySelectorAll('tbody tr');
            const headers = table.querySelectorAll('thead th');
            const isSegmentChart = segmentCharts.includes(currentChartType);
            const isScatterBubble = ['scatter', 'bubble'].includes(currentChartType);
            
            const datasets = [];

            // 1. Handle Segment Charts (Pie, Doughnut, PolarArea)
            if (isSegmentChart) {
                // Segment charts use the first data column for values, and rows for labels
                const labels = Array.from(rows).map(row => row.cells[0]?.querySelector('input').value || 'N/A');
                const dataValues = Array.from(rows).map(row => parseFloat(row.cells[1]?.querySelector('input').value) || 0);

                datasets.push({
                    label: document.getElementById('chartTitle').value || 'Data',
                    data: dataValues,
                    backgroundColor: dataValues.map((_, i) => getDatasetColor(0, i)),
                    // Border is important for segment charts
                    borderColor: '#ffffff',
                    borderWidth: 2
                });
                return { labels, datasets };
            }

            // 2. Handle Scatter and Bubble Charts
            if (isScatterBubble) {
                // Scatter/Bubble data structure is {x: v1, y: v2, r?: v3}
                // Table structure: Label | X | Y | R (optional) | Y2 (optional) ...
                
                const tableColCount = headers.length;
                let xColIndex = 1; // X is always the second column after Label
                let rColIndex = 3; // R is the fourth column for bubble
                
                if (currentChartType === 'bubble' && tableColCount >= 4) {
                    // Bubble is a single dataset: uses X(1), Y(2), R(3) columns
                    const data = Array.from(rows).map(row => ({
                        x: parseFloat(row.cells[xColIndex]?.querySelector('input').value) || 0,
                        y: parseFloat(row.cells[xColIndex + 1]?.querySelector('input').value) || 0,
                        r: parseFloat(row.cells[rColIndex]?.querySelector('input').value) || 5 
                    }));
                    datasets.push({
                        label: 'Bubble Data',
                        data: data,
                        backgroundColor: getDatasetColor(0),
                    });
                    return { datasets }; // Scatter/Bubble charts don't use 'labels' for the x-axis typically
                } 
                
                if (currentChartType === 'scatter' && tableColCount >= 3) {
                    // Scatter: X is column 1, subsequent columns are Y datasets
                    for (let i = 2; i < tableColCount; i++) { // Start at index 2 (third column) for Y values
                        const data = Array.from(rows).map(row => ({
                            x: parseFloat(row.cells[xColIndex]?.querySelector('input').value) || 0,
                            y: parseFloat(row.cells[i]?.querySelector('input').value) || 0
                        }));
                        datasets.push({
                            label: headers[i].textContent,
                            data: data,
                            backgroundColor: getDatasetColor(i - 2), // Index relative to datasets
                            borderColor: getDatasetColor(i - 2),
                        });
                    }
                    return { datasets };
                }
            }


            // 3. Handle Standard Charts (Bar, Line, Radar)
            const labels = Array.from(rows).map(row => row.cells[0]?.querySelector('input').value || 'N/A');
            
            for (let i = 1; i < headers.length; i++) { // Start loop from 1 to skip the label column
                const data = Array.from(rows).map(row => parseFloat(row.cells[i]?.querySelector('input').value) || 0);
                const color = getDatasetColor(i - 1); // i-1 converts table column index to dataset index

                datasets.push({
                    label: headers[i].textContent,
                    data: data,
                    backgroundColor: color,
                    borderColor: currentChartType === 'line' ? color : 'rgba(0,0,0,0.1)',
                    borderWidth: currentChartType === 'line' ? 3 : 1,
                    fill: currentChartType === 'radar', // Fill radar charts by default
                    tension: currentChartType === 'line' ? 0.3 : 0, // Slight curve for line charts
                });
            }
            
            return { labels, datasets };
        }

        /**
         * Retrieves the stored color for a dataset/point index, or uses the default color.
         * @param {number} datasetIndex - The index of the dataset.
         * @param {number} pointIndex - The index of the point (for segment charts).
         * @returns {string} The color hex code.
         */
        function getDatasetColor(datasetIndex, pointIndex = null) {
            const index = pointIndex !== null ? pointIndex : datasetIndex;
            const colors = segmentCharts.includes(currentChartType) ? pieDoughnutColors : defaultColors;
            
            const colorInput = document.querySelector(`.series-color[data-index="${index}"]`);
            if (colorInput) {
                return colorInput.value;
            }
            return colors[index % colors.length];
        }

        /**
         * Initializes or re-initializes the chart with current settings.
         */
        function initChart() {
            if (chart) {
                chart.destroy();
            }

            const ctx = document.getElementById('chartCanvas').getContext('2d');
            const data = getChartData();
            
            // Define chart options, handling scales for different types
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: false }
                }
            };
            
            // Only add scales for chart types that use them
            if (coordinateCharts.includes(currentChartType) && currentChartType !== 'scatter') {
                 options.scales = {
                    y: { beginAtZero: true },
                    x: {
                        // Ensure X-axis works correctly for Bar/Line
                        type: 'category',
                        beginAtZero: true
                    }
                };
            }
            
            // Special scale handling for Scatter/Bubble (numeric X axis)
            if (currentChartType === 'scatter' || currentChartType === 'bubble') {
                 options.scales = {
                    y: { beginAtZero: true, title: { display: true, text: 'Y Axis Value' } },
                    x: { type: 'linear', position: 'bottom', title: { display: true, text: 'X Axis Value' } }
                };
            }

            chart = new Chart(ctx, {
                type: currentChartType,
                data: data,
                options: options
            });
            updateChartTitle();
            updateColorPalette();
        }

        /**
         * Updates the chart with fresh data from the table.
         */
        function updateChart() {
            if (!chart) {
                initChart(); // Re-initialize if the chart was destroyed/not created
                return;
            }
            chart.data = getChartData();
            updateChartTitle();
            chart.update();
        }

        function updateChartTitle() {
            document.getElementById('displayChartTitle').textContent = document.getElementById('chartTitle').value;
        }

        // --- UI & TABLE MANAGEMENT ---

        /**
         * Updates the data table structure (headers and rows) based on user input.
         */
        function updateDataStructure() {
            const seriesCount = parseInt(seriesCountInput.value);
            const labelCount = parseInt(labelCountInput.value);

            // Update Headers and get the actual resulting number of columns
            const headerCount = updateTableHeaders(seriesCount);

            // Update Body
            const table = document.getElementById('dataTable');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';

            for (let i = 1; i <= labelCount; i++) {
                const row = document.createElement('tr');
                let rowHTML = `<td><input type="text" value="Label ${i}"></td>`;
                
                // Start populating data columns (from index 1 up to headerCount-1)
                for (let j = 1; j < headerCount; j++) {
                    const randomValue = Math.floor(Math.random() * 50) + 10;
                    rowHTML += `<td><input type="number" value="${randomValue}"></td>`;
                }
                row.innerHTML = rowHTML;
                tbody.appendChild(row);
            }
            
            initChart(); // Re-initializes and draws the new chart.
        }

        /**
         * Updates the table headers to be intuitive for the selected chart type.
         * @param {number} seriesCount - The number of data series requested by the user.
         * @returns {number} The actual number of columns (headers) generated.
         */
        function updateTableHeaders(seriesCount) {
            const thead = document.querySelector('#dataTable thead');
            let headers = ['Label'];
            let actualSeriesCount = seriesCount;

            if (currentChartType === 'scatter') {
                // Scatter requires at least 1 X column and 1 Y column, so 2 data columns minimum
                if (seriesCount < 1) actualSeriesCount = 1; // Enforce minimum 1 Y series
                headers.push('X Axis (Series 1)');
                for (let i = 1; i <= actualSeriesCount; i++) headers.push(`Y Axis (Series ${i + 1})`);
            } else if (currentChartType === 'bubble') {
                // Bubble requires X, Y, and Radius (R), so 3 data columns
                actualSeriesCount = 3;
                headers.push('X Axis (Value)', 'Y Axis (Value)', 'Radius (Size)');
                seriesCountInput.value = 3;
                seriesCountInput.disabled = true; // Disabled for Bubble
            } else if (segmentCharts.includes(currentChartType)) {
                // Pie/Doughnut/PolarArea usually represent one dataset broken into segments
                headers.push('Value'); // Only one value column is truly relevant
                actualSeriesCount = 1;
                seriesCountInput.value = 1;
                seriesCountInput.disabled = true; // Disabled for segment charts
            } else {
                // Standard Charts (Bar, Line, Radar)
                seriesCountInput.disabled = false;
                for (let i = 1; i <= seriesCount; i++) headers.push(`Series ${i}`);
            }
            
            thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
            return headers.length;
        }
        
        /**
         * Adds a new row to the data table.
         */
        function addRow() {
            const table = document.getElementById('dataTable');
            const tbody = table.querySelector('tbody');
            const newRow = document.createElement('tr');
            const colCount = table.querySelector('thead tr').cells.length;

            let newRowHTML = `<td><input type="text" value="Label ${tbody.rows.length + 1}"></td>`;
            for (let i = 1; i < colCount; i++) {
                newRowHTML += `<td><input type="number" value="${Math.floor(Math.random() * 50) + 10}"></td>`;
            }
            newRow.innerHTML = newRowHTML;
            tbody.appendChild(newRow);

            // Update the label count input to reflect the new number of rows
            labelCountInput.value = tbody.rows.length;
            updateChart();
            updateColorPalette(); // Refresh palette if we added a new segment for pie/doughnut
        }

        /**
         * Generates color picker inputs for each data series or data point (for segment charts).
         */
        function updateColorPalette() {
            const container = document.getElementById('colorPalette');
            container.innerHTML = '';

            const isSegmentChart = segmentCharts.includes(currentChartType);
            
            let elementsToColor = [];
            
            if (!chart || chart.data.datasets.length === 0) {
                 // Fallback if chart isn't initialized yet
                container.innerHTML = '<p class="form-label" style="font-style: italic; margin-top: 10px;">Click "Regenerate Table & Chart" to load color options.</p>';
                return;
            }

            if (isSegmentChart) {
                // For segment charts (Pie/Doughnut/Polar), colors apply to each label/point
                const labels = chart.data.labels;
                const currentColors = chart.data.datasets[0].backgroundColor;
                
                labels.forEach((label, i) => {
                    elementsToColor.push({ 
                        label: `Segment: ${label}`, 
                        color: currentColors[i] || pieDoughnutColors[i % pieDoughnutColors.length], 
                        index: i,
                        isPoint: true // Marker for point coloring
                    });
                });
            } else {
                // For coordinate charts, colors apply to each dataset/series
                chart.data.datasets.forEach((dataset, i) => {
                    elementsToColor.push({
                        label: dataset.label,
                        color: dataset.backgroundColor, 
                        index: i,
                        isPoint: false // Marker for series coloring
                    });
                });
            }

            elementsToColor.forEach(el => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'form-group';
                colorDiv.innerHTML = `
                    <label class="form-label">${el.label} Color</label>
                    <input type="color" class="form-input series-color" value="${el.color}" 
                           data-index="${el.index}" data-is-point="${el.isPoint}">
                `;
                container.appendChild(colorDiv);
            });
        }

        /**
         * Downloads the current chart canvas as a PNG image.
         */
        function downloadChart() {
            if (!chart) return;
            const link = document.createElement('a');
            const title = document.getElementById('chartTitle').value.replace(/ /g, '_');
            // Use chart.toBase64Image directly, as it handles the scale factor correctly.
            link.download = `${title}.png`;
            link.href = chart.toBase64Image('image/png', 1.0); 
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- EVENT LISTENERS ---
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initial setup (must be called after DOM is ready)
            updateDataStructure(); 

            // Toolbar: Chart type selection
            document.querySelectorAll('.tool-button').forEach(button => {
                button.addEventListener('click', function() {
                    currentChartType = this.dataset.chartType;
                    
                    // Reset disabled state
                    seriesCountInput.disabled = false;
                    labelCountInput.disabled = false;
                    
                    document.querySelectorAll('.tool-button').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Force a full structure update, which handles disabling inputs and re-initializing the chart
                    updateDataStructure();
                });
            });
            
            // Sidebar controls (Regenerate button)
            document.getElementById('updateDataBtn').addEventListener('click', updateDataStructure);
            
            // Chart Title live update
            document.getElementById('chartTitle').addEventListener('input', updateChartTitle);
            
            // Add row button
            document.getElementById('addRowBtn').addEventListener('click', addRow);
            
            // Live updates from data table
            document.getElementById('dataTable').addEventListener('input', (e) => {
                if (e.target.tagName === 'INPUT') {
                    // We only need to update the chart data, not the structure
                    updateChart();
                    
                    // If it's a segment chart, the label might have changed, so update the palette too.
                    if (segmentCharts.includes(currentChartType)) {
                        updateColorPalette();
                    }
                }
            });

            // Live updates from color pickers
            document.getElementById('colorPalette').addEventListener('change', (e) => {
                if (e.target.classList.contains('series-color')) {
                    const index = parseInt(e.target.dataset.index);
                    const isPoint = e.target.dataset.isPoint === 'true';
                    const newColor = e.target.value;

                    if (isPoint) {
                        // Segment charts (Pie/Doughnut/Polar): Color applies to data points in the FIRST dataset
                        if (chart.data.datasets[0].backgroundColor) {
                             // Ensure backgroundColor is an array before setting the value
                            if (!Array.isArray(chart.data.datasets[0].backgroundColor)) {
                                chart.data.datasets[0].backgroundColor = Array(chart.data.labels.length).fill(chart.data.datasets[0].backgroundColor);
                            }
                            chart.data.datasets[0].backgroundColor[index] = newColor;
                        }
                    } else {
                        // Coordinate charts (Bar/Line/Radar/Scatter/Bubble): Color applies to the whole dataset
                        if (chart.data.datasets[index]) {
                            chart.data.datasets[index].backgroundColor = newColor;
                            chart.data.datasets[index].borderColor = newColor;
                        }
                    }
                    chart.update();
                }
            });
            
            // Download button
            document.getElementById('downloadBtn').addEventListener('click', downloadChart);
        });
    </script>
    <script>
(() => {
  // Updated Storage Key for Chart Maker
  const STORAGE_KEY = "docuwritepro_chart_maker_guide_seen";
  if (localStorage.getItem(STORAGE_KEY)) return;

  const tips = [
    "Welcome to Chart Maker! Start by selecting your preferred visualization type—like Bar, Line, Pie, or Radar—from the 'Chart Type' dropdown.",
    "Use the 'Labels' section to define the categories for your X-axis or the slices of your pie chart.",
    "Add one or more 'Datasets' to plot your values. You can name each dataset to clearly identify different data series in the legend.",
    "Want to compare multiple categories? Click 'Add Dataset' to overlay another set of values onto your current chart.",
    "In the 'Data Values' input, enter numbers separated by commas. Make sure the number of values matches the number of labels you created.",
    "Customize the look of your chart by clicking the color icons next to each dataset or individual data point to change their appearance.",
    "For Bar and Line charts, use the 'Options' panel to toggle grid lines on or off for a cleaner presentation.",
    "The chart updates in real-time as you type, allowing you to see exactly how your data looks before you save it.",
    "Ready to use your creation? Click 'Download Chart' to save your visualization as a high-resolution PNG image.",
    "If you want to start over with a different layout, use the 'Reset' button to clear all current labels and data points."
  ];

  let index = 0;
  let direction = 1;

  /* Container */
  const box = document.createElement("div");
  box.id = "dwp-tip-box";
  box.innerHTML = `
    <div class="dwp-progress">
      <div class="dwp-progress-bar"></div>
    </div>

    <div class="dwp-tip-wrapper">
      <div class="dwp-tip-text"></div>
    </div>

    <div class="dwp-actions">
      <button class="dwp-prev">Back</button>
      <button class="dwp-next">Next</button>
    </div>
  `;
  document.body.appendChild(box);

  const textEl = box.querySelector(".dwp-tip-text");
  const nextBtn = box.querySelector(".dwp-next");
  const prevBtn = box.querySelector(".dwp-prev");
  const progressBar = box.querySelector(".dwp-progress-bar");

  function updateTip(animate = true) {
    if (animate) {
      textEl.classList.remove("slide-in-left", "slide-in-right");
      void textEl.offsetWidth;
      textEl.classList.add(direction > 0 ? "slide-in-right" : "slide-in-left");
    }

    textEl.textContent = tips[index];
    progressBar.style.width = `${((index + 1) / tips.length) * 100}%`;

    prevBtn.style.visibility = index === 0 ? "hidden" : "visible";
    nextBtn.textContent = index === tips.length - 1 ? "Got it" : "Next";
  }

  nextBtn.onclick = () => {
    if (index === tips.length - 1) {
      localStorage.setItem(STORAGE_KEY, "true");
      box.classList.add("fade-out");
      setTimeout(() => box.remove(), 300);
    } else {
      direction = 1;
      index++;
      updateTip();
    }
  };

  prevBtn.onclick = () => {
    if (index > 0) {
      direction = -1;
      index--;
      updateTip();
    }
  };

  setTimeout(() => {
    box.classList.add("show");
    updateTip(false);
  }, 1000);

  /* Styles */
  const style = document.createElement("style");
  style.textContent = `
    #dwp-tip-box {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 320px;
      background: #1a73e8; /* Matched to the Chart Maker's primary blue theme */
      color: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      font-family: 'Roboto', 'Inter', system-ui, sans-serif;
      z-index: 10000;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity .3s ease, transform .3s ease;
    }

    #dwp-tip-box.show {
      opacity: 1;
      transform: translateY(0);
    }

    #dwp-tip-box.fade-out {
      opacity: 0;
      transform: translateY(-10px);
    }

    .dwp-progress {
      height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 99px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .dwp-progress-bar {
      height: 100%;
      width: 0%;
      background: #fff;
      transition: width .35s ease;
    }

    .dwp-tip-wrapper {
      overflow: hidden;
      min-height: 65px;
      display: flex;
      align-items: center;
    }

    .dwp-tip-text {
      font-size: 14px;
      line-height: 1.5;
    }

    .slide-in-right {
      animation: slideRight .25s ease;
    }

    .slide-in-left {
      animation: slideLeft .25s ease;
    }

    @keyframes slideRight {
      from { opacity: 0; transform: translateX(12px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideLeft {
      from { opacity: 0; transform: translateX(-12px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .dwp-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 16px;
    }

    .dwp-actions button {
      border: none;
      padding: 7px 15px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .dwp-prev {
      background: rgba(255,255,255,0.15);
      color: #fff;
    }

    .dwp-prev:hover {
      background: rgba(255,255,255,0.25);
    }

    .dwp-next {
      background: #fff;
      color: #1a73e8;
    }

    .dwp-next:hover {
      background: #f1f3f4;
    }
  `;
  document.head.appendChild(style);
})();
    </script>
</body>
</html>
