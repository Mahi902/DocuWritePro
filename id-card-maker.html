<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID Card Maker</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --accent: #4f46e5;
            --card-border: #e2e8f0;
        }

        .dark {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #818cf8;
            --card-border: #1e1e1e;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100vh;
        }

        /* Hidden Master Cards for rendering */
        #render-container {
            position: absolute;
            left: -9999px;
            top: -9999px;
        }

        .id-card {
            width: 1011px;
            height: 638px;
            border-radius: 45px;
            background: white;
            overflow: hidden;
            color: #1e293b;
            position: relative;
        }

        /* Themes for the Card Interior */
        .theme-white { background: #ffffff; }
        .theme-blue { background: #f0f7ff; }
        .theme-yellow { background: #fffdf0; }
        .theme-pink { background: #fff0f6; }
        .theme-green { background: #f0fff4; }

        .wave-path { transition: fill 0.3s ease; }
        .theme-white .wave-path { fill: #f1f5f9; }
        .theme-blue .wave-path { fill: #dbeafe; }
        .theme-yellow .wave-path { fill: #fef9c3; }
        .theme-pink .wave-path { fill: #fce7f3; }
        .theme-green .wave-path { fill: #dcfce7; }

        .glass-input {
            background: var(--bg-primary);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            transition: all 0.2s;
        }
        .glass-input:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
        }

        .watermark {
            font-family: 'Oswald', sans-serif;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 150px;
            opacity: 0.05;
            pointer-events: none;
            z-index: 1;
            text-transform: uppercase;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .theme-btn.active { border-color: var(--accent); transform: scale(1.1); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .action-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>

    <!-- Header Navigation -->
    <nav class="sticky top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-[var(--card-border)] bg-[var(--bg-primary)] bg-opacity-80 backdrop-blur-md">
        <div class="flex items-center gap-2">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <span class="material-icons-round text-white">badge</span>
            </div>
            <span class="text-xl font-bold tracking-tight">ID Card <span class="text-indigo-600">Maker</span></span>
        </div>
        
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-900 transition-colors">
            <span id="theme-icon" class="material-icons-round">light_mode</span>
        </button>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-8 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <!-- Left Column: Form Controls -->
            <div class="lg:col-span-7 space-y-6">
                <section class="bg-[var(--bg-primary)] p-8 rounded-3xl border border-[var(--card-border)] shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold flex items-center gap-2">
                            <span class="material-icons-round text-indigo-500">assignment</span> 
                            Identity Information
                        </h2>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Photo Uploads -->
                        <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <label class="flex flex-col items-center justify-center border-2 border-dashed border-[var(--card-border)] rounded-2xl p-6 cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-all dark:hover:bg-zinc-900">
                                <span class="material-icons-round text-3xl text-gray-400">add_a_photo</span>
                                <span class="text-xs font-bold mt-2 uppercase tracking-tight">Profile</span>
                                <input id="image-upload" type="file" class="hidden" accept="image/*">
                            </label>
                            <label class="flex flex-col items-center justify-center border-2 border-dashed border-[var(--card-border)] rounded-2xl p-6 cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-all dark:hover:bg-zinc-900">
                                <span class="material-icons-round text-3xl text-gray-400">business</span>
                                <span class="text-xs font-bold mt-2 uppercase tracking-tight">Logo</span>
                                <input id="logo-upload" type="file" class="hidden" accept="image/*">
                            </label>
                            <label class="flex flex-col items-center justify-center border-2 border-dashed border-[var(--card-border)] rounded-2xl p-6 cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-all dark:hover:bg-zinc-900">
                                <span class="material-icons-round text-3xl text-gray-400">draw</span>
                                <span class="text-xs font-bold mt-2 uppercase tracking-tight">Signature</span>
                                <input id="signature-upload" type="file" class="hidden" accept="image/*">
                            </label>
                        </div>

                        <div class="md:col-span-2">
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">Full Name</label>
                            <input type="text" id="name" placeholder="e.g. Alexander Pierce" class="glass-input p-4 rounded-2xl w-full text-lg">
                        </div>
                        
                        <div>
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">Date of Birth</label>
                            <input type="date" id="dob" class="glass-input p-4 rounded-2xl w-full">
                        </div>
                        <div>
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">Blood Group</label>
                            <select id="blood-group" class="glass-input p-4 rounded-2xl w-full">
                                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                                <option>AB+</option><option>AB-</option><option selected>O+</option><option>O-</option>
                            </select>
                        </div>

                        <div>
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">Phone</label>
                            <input type="tel" id="phone" placeholder="+1 234 567 890" class="glass-input p-4 rounded-2xl w-full">
                        </div>
                        <div>
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">WhatsApp (QR Code)</label>
                            <input type="tel" id="whatsapp" placeholder="Phone for QR link" class="glass-input p-4 rounded-2xl w-full">
                        </div>

                        <div class="md:col-span-2">
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">Home Address</label>
                            <textarea id="address" placeholder="123 Workspace St, Digital City" rows="2" class="glass-input p-4 rounded-2xl w-full"></textarea>
                        </div>
                        
                        <div>
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">Issue Date</label>
                            <input type="date" id="issue-date-input" class="glass-input p-4 rounded-2xl w-full">
                        </div>
                        <div>
                            <label class="text-[11px] font-bold text-[var(--text-secondary)] uppercase ml-1 mb-1 block">Expiry Date</label>
                            <input type="date" id="expiry-date-input" class="glass-input p-4 rounded-2xl w-full">
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Column: Control Center -->
            <div class="lg:col-span-5 space-y-6 lg:sticky lg:top-24">
                <section class="bg-[var(--bg-primary)] p-8 rounded-3xl border border-[var(--card-border)] shadow-sm">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                        <span class="material-icons-round text-indigo-500">auto_awesome</span> 
                        Visual Style
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <p class="text-sm text-[var(--text-secondary)] mb-3 font-medium">Select Card Theme</p>
                            <div id="theme-selector" class="flex gap-3">
                                <button data-theme="white" title="Classic White" class="theme-btn active bg-slate-50 border-slate-200"></button>
                                <button data-theme="blue" title="Professional Blue" class="theme-btn bg-blue-100 border-blue-200"></button>
                                <button data-theme="yellow" title="Warning Yellow" class="theme-btn bg-yellow-100 border-yellow-200"></button>
                                <button data-theme="pink" title="Modern Pink" class="theme-btn bg-pink-100 border-pink-200"></button>
                                <button data-theme="green" title="Corporate Green" class="theme-btn bg-emerald-100 border-emerald-200"></button>
                            </div>
                        </div>

                        <div class="pt-6 border-t border-[var(--card-border)]">
                            <p class="text-sm font-bold text-[var(--text-secondary)] uppercase tracking-widest mb-4">Preview & Export</p>
                            
                            <div class="grid grid-cols-1 gap-4">
                                <!-- Front Action -->
                                <div class="action-card group p-4 bg-[var(--bg-secondary)] border border-[var(--card-border)] rounded-2xl flex items-center gap-4 cursor-pointer" onclick="openPreview('id-front')">
                                    <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-xl flex items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                        <span class="material-icons-round">vignette</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-sm">Front Side Preview</h4>
                                        <p class="text-xs text-[var(--text-secondary)]">View full-res 300DPI image</p>
                                    </div>
                                    <span class="material-icons-round text-gray-400">open_in_new</span>
                                </div>

                                <!-- Back Action -->
                                <div class="action-card group p-4 bg-[var(--bg-secondary)] border border-[var(--card-border)] rounded-2xl flex items-center gap-4 cursor-pointer" onclick="openPreview('id-back')">
                                    <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-xl flex items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                        <span class="material-icons-round">qr_code_2</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-sm">Back Side Preview</h4>
                                        <p class="text-xs text-[var(--text-secondary)]">Check barcode and signature</p>
                                    </div>
                                    <span class="material-icons-round text-gray-400">open_in_new</span>
                                </div>
                            </div>
                        </div>

                        <div class="pt-6">
                            <button onclick="bulkDownload()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-lg shadow-indigo-200 dark:shadow-none transition-all flex items-center justify-center gap-2">
                                <span class="material-icons-round">file_download</span>
                                Download Both (ZIP / Package)
                            </button>
                        </div>
                    </div>
                </section>

                <div class="p-6 bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-900/50 rounded-2xl flex gap-4">
                    <span class="material-icons-round text-amber-500">info</span>
                    <p class="text-xs leading-relaxed text-amber-800 dark:text-amber-200">
                        Changes are saved in real-time. Use the <strong>Preview</strong> buttons to verify high-definition layout before printing.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Rendering Area -->
    <div id="render-container">
        <!-- Front Master -->
        <div id="id-front" class="id-card theme-white">
            <div class="absolute inset-0 z-0">
                <svg class="w-full h-full" viewBox="0 0 1440 320" preserveAspectRatio="none">
                    <path class="wave-path" d="M0,224L80,213.3C160,203,320,181,480,186.7C640,192,800,224,960,229.3C1120,235,1280,213,1360,202.7L1440,192L1440,638L0,638Z"></path>
                </svg>
            </div>
            <div class="relative z-10 p-12 h-full flex flex-col">
                <div class="flex justify-between items-start">
                    <div class="max-w-[400px]">
                        <h2 id="card-title" class="text-5xl font-black text-slate-800 uppercase tracking-tighter">Identity Card</h2>
                        <img id="logo-preview" class="max-h-24 hidden object-contain" alt="Logo">
                    </div>
                    <span class="material-icons-round text-8xl text-slate-300">fingerprint</span>
                </div>
                <div class="flex mt-12 gap-12 items-center">
                    <div class="flex flex-col items-center gap-6">
                        <img id="profile-img-preview-master" src="https://placehold.co/400x400/f1f5f9/94a3b8?text=PHOTO" alt="Profile" style="width:240px;height:240px;object-fit:cover;border-radius:50%;border:12px solid white;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1);">
                        <div id="qr-code" class="bg-white p-2 rounded-xl"></div>
                    </div>
                    <div class="flex-1 space-y-6">
                        <div>
                            <p class="text-xl font-bold text-slate-400 uppercase tracking-widest">Full Name</p>
                            <h3 id="name-preview" class="text-6xl font-extrabold text-slate-800 leading-none">John Doe</h3>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-lg font-bold text-slate-400 uppercase">Birth Date</p>
                                <p id="dob-preview" class="text-3xl font-bold text-slate-700">-- -- ----</p>
                            </div>
                            <div>
                                <p class="text-lg font-bold text-slate-400 uppercase">Blood Group</p>
                                <p id="blood-group-preview" class="text-4xl font-black text-red-600">O+</p>
                            </div>
                        </div>
                        <div>
                            <p class="text-lg font-bold text-slate-400 uppercase">Address</p>
                            <p id="address-preview" class="text-2xl font-medium text-slate-600 line-clamp-2">Not provided</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Back Master -->
        <div id="id-back" class="id-card theme-white">
            <div class="watermark">DOCUWRITEPRO</div>
            <div class="relative z-10 p-12 h-full flex flex-col justify-between">
                <div class="flex flex-col items-center">
                    <svg id="barcode" class="w-full max-h-32"></svg>
                    <p class="mt-4 text-center text-slate-400 font-medium text-lg leading-relaxed">
                        If found, please return to the nearest authorities or contact the number on the front of this card. This document is official property.
                    </p>
                </div>
                <div class="flex justify-between items-end border-t-2 border-slate-100 pt-8">
                    <div class="space-y-2">
                        <p class="text-lg font-bold text-slate-400 uppercase">Validity</p>
                        <div class="text-xl font-bold text-slate-700">
                            Issued: <span id="issue-date-preview" class="text-slate-500">----</span><br>
                            Expires: <span id="expiry-date-preview" class="text-slate-500">----</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="signature-placeholder" class="h-20 w-48 border-b-2 border-slate-300 flex items-center justify-center italic text-slate-300">
                            Holder Signature
                        </div>
                        <img id="signature-preview" class="h-24 max-w-[200px] object-contain hidden border-b-2 border-slate-300" alt="Sign">
                        <p class="text-xs font-bold text-slate-400 mt-2 uppercase">AUTHORIZED SIGNATURE</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme Management
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            if (themeToggle) {
                const setTheme = (isDark) => {
                    if (isDark) {
                        document.documentElement.classList.add('dark');
                        themeIcon.textContent = 'dark_mode';
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                        themeIcon.textContent = 'light_mode';
                        localStorage.setItem('theme', 'light');
                    }
                };

                themeToggle.addEventListener('click', () => {
                    const isDark = document.documentElement.classList.contains('dark');
                    setTheme(!isDark);
                });

                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    setTheme(true);
                }
            }

            // Input Handling
            const inputs = {
                name: document.getElementById('name'),
                dob: document.getElementById('dob'),
                phone: document.getElementById('phone'),
                address: document.getElementById('address'),
                bloodGroup: document.getElementById('blood-group'),
                whatsapp: document.getElementById('whatsapp'),
                imageUpload: document.getElementById('image-upload'),
                logoUpload: document.getElementById('logo-upload'),
                signatureUpload: document.getElementById('signature-upload'),
                issueDate: document.getElementById('issue-date-input'),
                expiryDate: document.getElementById('expiry-date-input'),
            };

            const previews = {
                name: document.getElementById('name-preview'),
                dob: document.getElementById('dob-preview'),
                bloodGroup: document.getElementById('blood-group-preview'),
                address: document.getElementById('address-preview'),
                profileImg: document.getElementById('profile-img-preview-master'),
                logo: document.getElementById('logo-preview'),
                signature: document.getElementById('signature-preview'),
                issueDate: document.getElementById('issue-date-preview'),
                expiryDate: document.getElementById('expiry-date-preview'),
            };

            const qrContainer = document.getElementById('qr-code');

            const formatDate = (val) => {
                if (!val) return '----';
                const d = new Date(val);
                return d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
            };

            const updateAll = () => {
                if (previews.name) previews.name.textContent = inputs.name?.value || 'John Doe';
                if (previews.dob) previews.dob.textContent = formatDate(inputs.dob?.value);
                if (previews.bloodGroup) previews.bloodGroup.textContent = inputs.bloodGroup?.value || 'O+';
                if (previews.address) previews.address.textContent = inputs.address?.value || 'Not provided';
                if (previews.issueDate) previews.issueDate.textContent = formatDate(inputs.issueDate?.value);
                if (previews.expiryDate) previews.expiryDate.textContent = formatDate(inputs.expiryDate?.value);

                // Update QR
                if (qrContainer) {
                    const qrVal = inputs.whatsapp?.value || inputs.phone?.value || 'ID-Pro-User';
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, {
                        text: `https://wa.me/${qrVal.replace(/\D/g,'')}`,
                        width: 120,
                        height: 120,
                        colorDark: "#1e293b",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.M
                    });
                }

                // Update Barcode
                const barcodeEl = document.getElementById('barcode');
                if (barcodeEl) {
                    const barcodeData = [inputs.name?.value, inputs.phone?.value].filter(Boolean).join('-') || 'ID-PRO-001';
                    JsBarcode("#barcode", barcodeData.substring(0, 20), {
                        format: "CODE128",
                        width: 2,
                        height: 80,
                        displayValue: false,
                        lineColor: "#64748b"
                    });
                }
            };

            const readImage = (input, preview, callback) => {
                if (!input || !preview) return;
                const file = input.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.src = e.target.result;
                        preview.classList.remove('hidden');
                        if (callback) callback();
                    };
                    reader.readAsDataURL(file);
                }
            };

            if (inputs.imageUpload) inputs.imageUpload.addEventListener('change', () => readImage(inputs.imageUpload, previews.profileImg));
            if (inputs.logoUpload) inputs.logoUpload.addEventListener('change', () => {
                readImage(inputs.logoUpload, previews.logo, () => {
                    const cardTitle = document.getElementById('card-title');
                    if (cardTitle) cardTitle.classList.add('hidden');
                });
            });
            if (inputs.signatureUpload) inputs.signatureUpload.addEventListener('change', () => {
                readImage(inputs.signatureUpload, previews.signature, () => {
                    const signaturePlaceholder = document.getElementById('signature-placeholder');
                    if (signaturePlaceholder) signaturePlaceholder.classList.add('hidden');
                });
            });

            Object.values(inputs).forEach(el => {
                if (el) el.addEventListener('input', updateAll);
            });

            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    document.querySelectorAll('.id-card').forEach(card => {
                        card.className = `id-card theme-${theme}`;
                    });
                });
            });

            window.openPreview = async (id) => {
                const element = document.getElementById(id);
                if (!element) return;
                try {
                    const canvas = await html2canvas(element, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: null
                    });
                    
                    const dataUrl = canvas.toDataURL('image/png');
                    const newWindow = window.open();
                    newWindow.document.write(`
                        <html>
                            <head>
                                <title>ID Pro Preview</title>
                                <style>
                                    body { margin: 0; background: #0f172a; display: flex; align-items: center; justify-content: center; min-height: 100vh; font-family: sans-serif; }
                                    img { max-width: 90%; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border-radius: 20px; }
                                    .controls { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; }
                                    button { padding: 10px 20px; border-radius: 8px; border: none; background: #4f46e5; color: white; cursor: pointer; font-weight: bold; }
                                </style>
                            </head>
                            <body>
                                <div class="controls">
                                    <button onclick="window.print()">Print Card</button>
                                    <button onclick="window.close()">Close Preview</button>
                                </div>
                                <img src="${dataUrl}" />
                            </body>
                        </html>
                    `);
                } catch (err) {
                    console.error("Preview failed", err);
                }
            };

            window.bulkDownload = async () => {
                const sides = ['id-front', 'id-back'];
                for (const id of sides) {
                    const element = document.getElementById(id);
                    if (!element) continue;
                    const canvas = await html2canvas(element, { scale: 2 });
                    const link = document.createElement('a');
                    link.download = `${id}_${Date.now()}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                }
            };

            updateAll();
        });
    </script>
</body>
</html>
