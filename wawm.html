<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebGen</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
<style>
  * {
    box-sizing: border-box;
  }
  
  :root {
    --brand-gradient: linear-gradient(135deg, #0078ff, #0046ff);
    --body-bg: #f7f8fa;
    --chat-bg: #ffffff;
    --bot-bg: #ffffff;
    --user-bg: var(--brand-gradient);
    --input-bg: #f0f2f5;
    --text-primary: #1a1a1a;
    --text-secondary: #555;
    --border-color: #e8e8e8;
    --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
    --shadow-medium: 0 6px 16px rgba(0, 0, 0, 0.08);
  }

  body {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: var(--body-bg);
    font-family: "Inter", sans-serif;
    color: var(--text-primary);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* --- Header --- */
  header {
    height: 60px;
    background: var(--chat-bg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    padding: 0 24px;
    font-weight: 600;
    font-size: 18px;
    gap: 10px;
  }
  
  header .material-symbols-outlined {
    font-size: 24px;
    color: #0078ff;
  }

  /* --- Chat Area --- */
  #chat {
    flex: 1;
    overflow-y: auto;
    padding: 30px 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* --- Messages (The Chat Bubbles) --- */
  .message {
    max-width: 80%;
    padding: 14px 20px;
    border-radius: 20px;
    line-height: 1.5;
    font-size: 16px;
    position: relative;
    animation: fadeIn 0.4s ease-out;
    white-space: pre-wrap; /* Preserves line breaks */
  }

  .user {
    align-self: flex-end;
    background: var(--user-bg);
    color: white;
    border-bottom-right-radius: 6px;
  }

  .bot {
    align-self: flex-start;
    background: var(--bot-bg);
    color: var(--text-primary);
    border-bottom-left-radius: 6px;
    box-shadow: var(--shadow-medium);
  }
  /* --- End Chat Bubble Styles --- */

  .bot iframe {
    width: 100%;
    height: 500px;
    border: none;
    border-radius: 10px;
    margin-top: 12px;
    box-shadow: var(--shadow-light);
    background: #fff; /* Ensure iframe has a bg */
  }

  /* --- Footer Input --- */
  footer {
    display: flex;
    align-items: center;
    background: var(--chat-bg);
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
    padding: 20px 24px;
  }
  
  .input-wrapper {
    display: flex;
    flex: 1;
    position: relative;
    align-items: center;
  }

  footer input {
    flex: 1;
    border: none;
    outline: none;
    font-size: 16px;
    padding: 16px 60px 16px 24px; /* Room for icon */
    border-radius: 30px;
    background: var(--input-bg);
    font-family: "Inter", sans-serif;
  }
  
  footer input::placeholder {
    color: #999;
  }

  footer button {
    background: var(--brand-gradient);
    border: none;
    cursor: pointer;
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 120, 255, 0.3);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  footer button:hover {
    transform: translateY(-50%) scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 120, 255, 0.4);
  }

  footer .material-symbols-outlined {
    font-size: 24px;
    color: white;
  }
  
  /* --- Other --- */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  small {
    display: block;
    margin-top: 8px;
    font-size: 14px;
    color: var(--text-secondary);
    opacity: 0.9;
    line-height: 1.6;
    /* Ensure small tag also respects line breaks */
    white-space: pre-wrap; 
  }
  
  /* --- Custom Scrollbar --- */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  ::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #b3b3b3;
  }
</style>
</head>
<body>

<header>
  <span class="material-symbols-outlined">web</span>
  WebGen | AI Website Maker
</header>

<div id="chat">
  <div class="bot message">üëã Hi! I am WebGen. Describe your website idea below, and I‚Äôll create it for you.</div>
</div>

<footer>
  <div class="input-wrapper">
    <input id="userInput" type="text" placeholder="e.g., A portfolio for a nature photographer..." />
    <button id="sendBtn"><span class="material-symbols-outlined">send</span></button>
  </div>
</footer>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

sendBtn.onclick = sendPrompt;
input.addEventListener("keypress", e => {
  if (e.key === "Enter") sendPrompt();
});

function appendMessage(text, sender, html = false) {
  const msg = document.createElement("div");
  // This line creates the chat bubble
  msg.className = `message ${sender}`; 
  
  if (html) {
    msg.innerHTML = text;
  } else {
    msg.textContent = text;
  }
  
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
  return msg;
}

// --- Typing effect function ---
function typeText(element, text, speed = 20) {
  element.textContent = "";
  let i = 0;
  return new Promise(resolve => {
    const interval = setInterval(() => {
      if (i >= text.length) {
        clearInterval(interval);
        resolve();
        return;
      }
      element.textContent += text[i];
      i++;
      chat.scrollTop = chat.scrollHeight; // Auto-scroll as text types
    }, speed);
  });
}

async function sendPrompt() {
  const prompt = input.value.trim();
  if (!prompt) return;
  
  // Appends user message in a bubble
  appendMessage(prompt, "user");
  input.value = "";

  try {
    const descPrompt = encodeURIComponent(
      `The user wants to make a webpage. Describe what the user wants, describe the user's prompt, don't question anything, just describe what the user wants with the prompt: ${prompt}`
    );

    const response = await fetch(`https://text.pollinations.ai/${descPrompt}`);
    const text = await response.text();

    // --- LOGIC FOR BOT BUBBLE ---
    // 1. Create the bot message container (the bubble)
    const botMsg = document.createElement("div");
    botMsg.className = "message bot";
    
    // 2. Add the "Analysis:" title
    const title = document.createElement("div");
    title.textContent = "Analysis:";
    botMsg.appendChild(title);
    
    // 3. Create the <small> element for the typing text
    const desc = document.createElement("small");
    botMsg.appendChild(desc);
    
    // 4. Append the new bubble to the chat
    chat.appendChild(botMsg);
    chat.scrollTop = chat.scrollHeight;

    // 5. Call typeText on the <small> element *inside* the bubble
    await typeText(desc, text.trim());
    // --- END BOT BUBBLE LOGIC ---

    // After typing is done, show the generated site
    setTimeout(() => {
      // Appends the iframe in its own bubble
      appendMessage(
        `<div>Generation Started. Here is your generated website:</div>
         <iframe src="https://mahi902.github.io/DocuWritePro/webgen.html#${encodeURIComponent(prompt)}"></iframe>`,
        "bot",
        true
      );
      chat.scrollTop = chat.scrollHeight;
    }, 1000); // 1-second delay after typing finishes

  } catch (err) {
    // Appends an error message in a bubble
    appendMessage("‚ö†Ô∏è Something went wrong. Please try again.", "bot");
    console.error(err);
  }

  chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
