<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebGen Canvas</title>
<!-- Using Inter font for the UI -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code&display=swap" rel="stylesheet">
<!-- Material Symbols for icons -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

<style>
  * {
    box-sizing: border-box;
  }

  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100vh; /* Use vh for viewport height */
    font-family: "Inter", "Segoe UI", sans-serif;
    color: #222;
    /* This is the "canvas" background */
    background-color: #f0f2f5;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Prevents whole page scroll */
  }

  /* The main "bubble" container */
  #appContainer {
    width: 95vw;
    height: 90vh;
    max-width: 1400px; /* Max width for large screens */
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #dbe0e4;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05), 0 1px 4px rgba(0, 0, 0, 0.07);
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Ensures content respects rounded corners */
  }

  /* Wrapper for the main content (preview/code) */
  #contentWrapper {
    flex: 1; /* Takes up all available vertical space */
    position: relative; /* For centering the loading indicator */
    background: #f8f9fb; /* Background for the content area */
  }

  #loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 16px;
    color: #555;
    font-weight: 500;
  }

  /* The bottom control bar, now part of the bubble */
  #bottomMenu {
    width: 100%;
    background: #ffffff;
    border-top: 1px solid #dbe0e4;
    display: none; /* Hidden until loaded */
    align-items: center;
    padding: 10px 16px;
    font-size: 14px;
  }

  /* Wrapper for the view toggle buttons */
  .view-toggle {
    display: flex;
    background: #f0f2f5;
    border-radius: 8px;
    padding: 4px;
  }

  .toggle-btn {
    background: transparent;
    border: none;
    color: #444;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.2s ease;
  }

  .toggle-btn.active {
    background: #ffffff;
    color: #007aff;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .toggle-btn:not(.active):hover {
    background: #e9ecef;
  }

  /* Spacer to push other buttons to the right */
  .spacer {
    flex: 1;
  }

  /* Style for action buttons (Copy, Download) */
  .action-btn {
    background: #f3f4f6;
    border: 1px solid #dbe0e4;
    color: #333;
    padding: 6px 14px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
    transition: all 0.2s ease;
    margin-left: 8px;
  }
  .action-btn:hover {
    background: #e9ecef;
    border-color: #d1d5db;
  }
  .action-btn:active {
    background: #e1e3e6;
  }

  .menu-icon {
    font-family: 'Material Symbols Outlined';
    font-size: 18px;
    /* Fix for icon alignment */
    line-height: 1;
    font-variation-settings: 'wght' 400;
  }
  
  /* Success icon for copy button */
  .action-btn .icon-success {
    color: #28a745;
  }

  /* Iframe and Code view styles */
  iframe, pre {
    width: 100%;
    height: 100%;
    border: none;
    display: none; /* Hidden by default */
  }

  pre {
    margin: 0;
    padding: 16px;
    color: #111;
    overflow: auto; /* Allows scrolling for code */
    font-family: "Fira Code", monospace;
    line-height: 1.5;
    font-size: 14px;
    white-space: pre-wrap; /* Wraps code lines */
    background: #f8f9fb;
  }
</style>
</head>
<body>

<!-- The main "bubble" -->
<div id="appContainer">

  <!-- Main content area -->
  <div id="contentWrapper">
    <div id="loading">Generating your site...</div>
    <iframe id="previewFrame"></iframe>
    <pre id="codeView"></pre>
  </div>
  
  <!-- Bottom control bar -->
  <div id="bottomMenu">
    <div class="view-toggle">
      <button class="toggle-btn active" id="showLiveBtn">
        <span class="menu-icon">visibility</span> Live
      </button>
      <button class="toggle-btn" id="showCodeBtn">
        <span class="menu-icon">code</span> Code
      </button>
    </div>
    
    <div class="spacer"></div>
    
    <button class="action-btn" id="copyBtn">
      <span class="menu-icon">content_copy</span> Copy
    </button>
    <button class="action-btn" id="downloadBtn">
      <span class="menu-icon">download</span> Download
    </button>
  </div>

</div>

<script>
  async function generateHTML() {
    const loadingDiv = document.getElementById('loading');
    const bottomMenu = document.getElementById('bottomMenu');
    const previewFrame = document.getElementById('previewFrame');
    const codeView = document.getElementById('codeView');
    
    // Toggle Buttons
    const showLiveBtn = document.getElementById('showLiveBtn');
    const showCodeBtn = document.getElementById('showCodeBtn');

    // Action Buttons
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    let prompt = decodeURIComponent(location.hash.slice(1));
    if (!prompt) {
      loadingDiv.textContent = "No prompt found in URL hash!";
      return;
    }

    const strictPrompt = `Generate a full HTML webpage for this prompt: "${prompt}". You MUST wrap all CSS and JS inside the HTML file using <style> and <script> tags. Do not use any external files. Create a complete, self-contained, and modern webpage. Do not include markdown formatting like triple backticks.`;

    try {
      // API call to generate text
      const urlPrompt = encodeURIComponent(strictPrompt);
      // Using a different endpoint for potentially better HTML generation
      const response = await fetch(`https://text.pollinations.ai/prompt/${urlPrompt}`);
      let text = await response.text();

      // Clean up the response
      text = text.replace(/```html|```/gi, '').trim();
      // Ensure it starts with a doctype
      if (!text.toLowerCase().startsWith('<!doctype html')) {
          text = `<!DOCTYPE html>\n` + text;
      }

      // Set up UI
      bottomMenu.style.display = 'flex';
      loadingDiv.style.display = 'none';
      codeView.textContent = text;
      previewFrame.style.display = 'block'; // Show live preview by default

      // Create a blob URL for the iframe
      const blob = new Blob([text], { type: 'text/html' });
      const blobUrl = URL.createObjectURL(blob);
      previewFrame.src = blobUrl;

      // --- Event Listeners ---

      showLiveBtn.onclick = () => {
        previewFrame.style.display = 'block';
        codeView.style.display = 'none';
        showLiveBtn.classList.add('active');
        showCodeBtn.classList.remove('active');
      };

      showCodeBtn.onclick = () => {
        previewFrame.style.display = 'none';
        codeView.style.display = 'block';
        showCodeBtn.classList.add('active');
        showLiveBtn.classList.remove('active');
      };

      copyBtn.onclick = () => {
        // Use document.execCommand as a fallback for clipboard API in iFrames
        try {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; //avoid scrolling to bottom
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            // Visual feedback
            const originalIcon = copyBtn.innerHTML;
            copyBtn.innerHTML = '<span class="menu-icon icon-success">check</span> Copied!';
            setTimeout(() => copyBtn.innerHTML = originalIcon, 1500);

        } catch (err) {
            console.error('Failed to copy text: ', err);
            // Visual error feedback (optional)
            const originalIcon = copyBtn.innerHTML;
            copyBtn.innerHTML = '<span class="menu-icon icon-error">error</span> Failed';
            setTimeout(() => copyBtn.innerHTML = originalIcon, 1500);
        }
      };

      downloadBtn.onclick = () => {
        const link = document.createElement('a');
        link.href = blobUrl;
        link.download = 'generated_site.html';
        document.body.appendChild(link); // Required for Firefox
        link.click();
        document.body.removeChild(link);
      };

    } catch (e) {
      console.error(e);
      loadingDiv.textContent = "Error generating HTML.";
      loadingDiv.style.color = "#d9534f"; // Error color
    }
  }

  // Run the generation logic on page load
  generateHTML();
</script>
</body>
</html>
